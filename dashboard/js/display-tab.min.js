/* Search Pro v3.1 - Last Update on 10/31/2025 - Race Condition Fix */
class DisplayTabHandler{constructor(){this.core=null,this.tabId="display"}setCore(e){this.core=e}toAssetPath(e){if(!e)return"";const t=String(e).trim();return t.startsWith("http://")||t.startsWith("https://")||t.startsWith("/")||t.startsWith("assets/")?t:"assets/"+t.replace(/^\.?\/?assets\//,"")}filenameOnly(e){return e&&String(e).split("/").pop()||""}init(e){try{console.log("üëÅÔ∏è Initializing Display tab handler"),this.core.setupFormListeners(e),this.setupDisplayBehaviorHandlers(e),this.setupThumbnailHandlers(e),this.setupIconConfigurationHandlers(e),this.setupColorPickerHandlers(e),this.setupBorderValidation(e),this.setupResetButtonHandlers(e),this.populateDisplayForm(e),this.validateForm(e),console.log("‚úÖ Display tab handler initialized")}catch(e){console.error("‚ùå Error initializing Display tab:",e)}}setupResetButtonHandlers(e){try{const t=e.querySelectorAll(".reset-section-button");t.forEach(e=>{e.addEventListener("click",t=>{t.preventDefault();const o=e.dataset.section;"displayBehavior"===o?this.resetDisplayBehaviorToDefaults():"thumbnailVisibility"===o?this.resetThumbnailVisibilityToggles():"labelCustomization"===o?this.resetLabelCustomizationToDefaults():"labelFallback"===o?this.resetLabelFallbackToDefaults():"thumbnailSettings"===o?this.resetThumbnailToDefaults():"iconSettings"===o&&this.resetIconSettingsToDefaults()})}),console.log(`üîÑ Reset button handlers set up for ${t.length} buttons`)}catch(e){console.error("üö® Error setting up reset button handlers:",e)}}populateDisplayForm(e){try{this.core.populateForm(e),this.populateSubtitleToggles(),this.populateThumbnailForm(e),this.populateIconForm(e),this.populateLabelCustomizationForm(e),console.log("üëÅÔ∏è Display form populated with all sections")}catch(e){console.error("üö® Security: Error populating display form:",e)}}populateLabelCustomizationForm(e){try{const t=this.core.config.displayLabels||{},o={panoramaLabel:"Panorama",hotspotLabel:"Hotspot",polygonLabel:"Polygon",videoLabel:"Video",webframeLabel:"Webframe",imageLabel:"Image",textLabel:"Text",projectedImageLabel:"ProjectedImage",elementLabel:"Element",businessLabel:"Business","3dHotspotLabel":"3DHotspot","3dModelLabel":"3DModel","3dModelObjectLabel":"3DModelObject",containerLabel:"Container"};for(const[a,s]of Object.entries(o)){const o=a.startsWith("3d")?e.querySelector(`[id="${a}"]`):e.querySelector(`#${a}`);o&&(o.value=t[s]||s.replace(/([A-Z])/g," $1").trim())}console.log("üè∑Ô∏è Label customization form populated")}catch(e){console.error("üö® Security: Error populating label customization form:",e)}}toggleIconConfigurationSections(e){try{const t=document.querySelector('.config-section[aria-labelledby="icon-config-heading"]'),o=document.querySelector('.config-section[aria-labelledby="element-icons-heading"]');if(t){const o=t.querySelectorAll(".subsection");for(let t=1;t<o.length;t++)o[t].style.display=e?"":"none"}o&&(o.style.display=e?"":"none"),console.log("üé® Icon configuration sections "+(e?"shown":"hidden"))}catch(e){console.error("üö® Error toggling icon configuration sections:",e)}}setupTooltipHandlers(e){try{const t=e.querySelectorAll(".help-tooltip");t.forEach(e=>{e.addEventListener("mouseenter",()=>this.showTooltip(e)),e.addEventListener("mouseleave",()=>this.hideTooltip(e)),e.addEventListener("focus",()=>this.showTooltip(e)),e.addEventListener("blur",()=>this.hideTooltip(e)),e.addEventListener("keydown",t=>{"Escape"===t.key&&(this.hideTooltip(e),e.blur())})}),console.log(`üõà Tooltip handlers set up for ${t.length} tooltips`)}catch(e){console.error("üö® Error setting up tooltip handlers:",e)}}showTooltip(e){try{const t=e.getAttribute("data-tooltip");if(!t)return;this.hideAllTooltips();const o=document.createElement("div");o.className="tooltip-popup",o.setAttribute("role","tooltip"),o.textContent=t;const a=e.getBoundingClientRect(),s=window.scrollY||document.documentElement.scrollTop;o.style.left=`${a.left+a.width/2}px`,o.style.top=a.top+s-10+"px",document.body.appendChild(o),setTimeout(()=>{o.style.opacity="1",o.style.transform="translateY(-10px)"},10)}catch(e){console.error("üö® Error showing tooltip:",e)}}hideTooltip(e){try{document.querySelectorAll(".tooltip-popup").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(0)",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},200)})}catch(e){console.error("üö® Error hiding tooltip:",e)}}hideAllTooltips(){try{document.querySelectorAll(".tooltip-popup").forEach(e=>{e.style.opacity="0",e.style.transform="translateY(0)",setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},200)})}catch(e){console.error("üö® Error hiding all tooltips:",e)}}setupColorPickerHandlers(e){try{if(this._colorPickersReady)return;this._colorPickersReady=!0;const t=e.querySelectorAll(".color-input");t.forEach(e=>{const t=e.parentNode.querySelector(".color-hex-input");t&&(e.addEventListener("input",e=>{t.value=e.target.value,t.classList.remove("error"),this.core.onFormChange(e.target),"function"==typeof this.applyColorLivePreview&&this.applyColorLivePreview(e.target.id,e.target.value),"iconColor"===e.target.id&&this.syncIconColors(e.target.value)}),t.addEventListener("input",o=>{/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(o.target.value)?(e.value=o.target.value,t.classList.remove("error"),this.core.onFormChange(e),"function"==typeof this.applyColorLivePreview&&this.applyColorLivePreview(e.id,e.value),"iconColor"===e.id&&this.syncIconColors(o.target.value)):t.classList.add("error")}),t.value=e.value)}),console.log(`üé® Color picker handlers set up for ${t.length} inputs`)}catch(e){console.error("üö® Error setting up color picker handlers:",e)}}setupDisplayBehaviorHandlers(e=document){try{const t=e.querySelector('[aria-labelledby="display-behavior-heading"]');if(!t)return;const o=t.querySelectorAll(".toggle-input");o.forEach(e=>{e.addEventListener("change",e=>{this.handleDisplayBehaviorToggle(e.target)}),e.addEventListener("focus",e=>{e.target.closest(".form-group").classList.add("focused")}),e.addEventListener("blur",e=>{e.target.closest(".form-group").classList.remove("focused")})}),this.setupTooltipHandlers(t),console.log(`üëÅÔ∏è Display behavior handlers set up for ${o.length} toggles`)}catch(e){console.error("üö® Security: Error setting up display behavior handlers:",e)}}setupThumbnailHandlers(e=document){try{const t=e.querySelector('[aria-labelledby="thumbnail-config-heading"]');if(!t)return;const o=t.querySelector("#enableThumbnails");o&&o.addEventListener("change",e=>{this.handleThumbnailToggle(e.target)});const a=t.querySelector("#thumbnailBorderColor");a&&a.addEventListener("input",e=>{this.handleColorInputChange(e.target)});const s=t.querySelector("#thumbnailBorderColor + .color-hex-input");s&&s.addEventListener("input",e=>{this.handleHexInputChange(e.target)});const n=t.querySelector("#thumbnailSizePreset");n&&n.addEventListener("change",e=>{this.handleThumbnailSizeChange(e.target)}),t.querySelectorAll(".range-input").forEach(e=>{e.addEventListener("input",e=>{this.updateRangeValue(e.target)})}),this.setupGlobalDefaultPathHandler(t),console.log("üñºÔ∏è Thumbnail handlers initialized")}catch(e){console.error("üö® Security: Error setting up thumbnail handlers:",e)}}setupIconConfigurationHandlers(e=document){try{this.setupFontAwesomeIcons();const t=e.querySelector("#enableCustomIcons"),o=e.querySelector("#enableFontAwesome");t&&t.addEventListener("change",()=>{this.handleIconSystemToggle()}),o&&o.addEventListener("change",()=>{this.handleIconSystemToggle()});const a=e.querySelector("#iconSize");a&&a.addEventListener("change",e=>{this.handleIconSizeChange(e.target),this.validateIconSize(e.target)}),this.setupColorPickerHandlers(e),e.querySelectorAll(".range-input").forEach(e=>{this.updateRangeValue(e),e.addEventListener("input",e=>{this.updateRangeValue(e.target)}),e.addEventListener("change",e=>{this.updateRangeValue(e.target),this.core.onFormChange(e.target)})}),this.initializeIconPickerGrids(e),e.querySelectorAll(".icon-picker-type").forEach(e=>{e.addEventListener("change",e=>{const t=e.target.dataset.element,o=e.target.value;this.switchIconPickerType(t,o)})}),console.log("üé® Icon configuration handlers initialized")}catch(e){console.error("üö® Error setting up icon configuration handlers:",e)}}handleIconSystemToggle(){try{const e=document.querySelector("#enableCustomIcons"),t=document.querySelector("#enableFontAwesome"),o=document.querySelector("#iconConflictWarning"),a=document.querySelector("#fontAwesomeCdnSection");if(!e||!t)return;const s=e.checked,n=t.checked;if(t.disabled=!s,s||(t.checked=!1,n&&this.core.showToast&&this.core.showToast("info","Custom Icons Required","Font Awesome feature requires Custom Icons to be enabled first.")),this.toggleIconConfigurationSections(s),a&&(a.style.display=s&&t.checked?"block":"none"),o){const e=s&&t.checked;o.style.display=e?"flex":"none"}this.core.onFormChange(e),s&&this.core.onFormChange(t),console.log(`üé® Icon system: Custom=${s}, FontAwesome=${t.checked}`)}catch(e){console.error("üö® Error handling icon system toggle:",e)}}handleIconSizeChange(e){try{const t=e.value;this.core.setNestedValue(this.core.config,"thumbnailSettings.iconSettings.iconSize",t),this.core.onFormChange(e),console.log(`üé® Icon size changed to: ${t}`)}catch(e){console.error("üö® Error handling icon size change:",e)}}initializeIconPickerGrids(e){try{["Panorama","Hotspot","Polygon","Video","Webframe","Image","Text","ProjectedImage","Element","Business","3DHotspot","Container","3DModel","3DModelObject"].forEach(e=>{this.populateIconGrid(e,"fontawesome"),this.updateCurrentIconDisplay(e)}),console.log("üé® Icon picker grids initialized")}catch(e){console.error("üö® Error initializing icon picker grids:",e)}}switchIconPickerType(e,t){try{this.populateIconGrid(e,t),console.log(`üîÑ Switched ${e} picker to ${t}`)}catch(e){console.error("üö® Error switching icon picker type:",e)}}getConsistentEmojiSet(e){try{if(window.EmojiLibrary){if(e&&"function"==typeof window.EmojiLibrary.getElementEmojis){const t=window.EmojiLibrary.getElementEmojis(e);if(t&&t.length>0)return t}if("function"==typeof window.EmojiLibrary.getAllEmojis){const e=window.EmojiLibrary.getAllEmojis();if(e&&e.length>0)return e}let t=[];for(const e in window.EmojiLibrary)Array.isArray(window.EmojiLibrary[e])&&(t=t.concat(window.EmojiLibrary[e]));for(const e in window.EmojiLibrary)if("object"==typeof window.EmojiLibrary[e]&&!Array.isArray(window.EmojiLibrary[e])){const o=window.EmojiLibrary[e];for(const e in o)if(Array.isArray(o[e]))t=t.concat(o[e]);else if("object"==typeof o[e])for(const a in o[e])Array.isArray(o[e][a])&&(t=t.concat(o[e][a]))}if(t.length>0)return[...new Set(t)]}return["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üòâ","üòä","üòã","üòé","üòç","üòò","‚åö","üì±","üíª","‚å®","üñ•","üñ®","üñ±","üñ≤","üïπ","üóú","üíΩ","üíæ","üíø","üìÄ","‚ù§","üíõ","üíö","üíô","üíú","üñ§","üíî","‚ù£","üíï","üíû","üíì","üíó","üíñ","üíò","üçè","üçé","üçê","üçä","üçã","üçå","üçâ","üçá","üçì","üçà","üçí","üçë","üçç","ü•ù","üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üêΩ","üöó","üöï","üöô","üöå","üöé","üèé","üöì","üöë","üöí","üöê","üöö","üöõ","üöú","üõ¥","‚öΩ","üèÄ","üèà","‚öæ","üéæ","üèê","üèâ","üé±","üèì","üè∏","ü•Ö","üèí","üèë","üèè"]}catch(e){return console.error("Error getting emoji set:",e),["üòÄ","üòÅ","üòÇ","ü§£","üòÉ","üòÑ","üòÖ","üòÜ","üì±","üíª","üñ•","üì∑","üé•","üì∫"]}}getFontAwesomeIcons(){try{if(void 0!==window.FontAwesome){const e=[];if(window.FontAwesome.library&&"function"==typeof window.FontAwesome.library.getIconNames)return window.FontAwesome.library.getIconNames();if(window.FontAwesome.definitions){for(const t in window.FontAwesome.definitions)for(const o in window.FontAwesome.definitions[t])e.push(`fa${t.charAt(0)} fa-${o}`);if(e.length>0)return e}}if(window.FontAwesomeIcons){const e=[];if(Array.isArray(window.FontAwesomeIcons.solid)&&e.push(...window.FontAwesomeIcons.solid),Array.isArray(window.FontAwesomeIcons.regular)&&e.push(...window.FontAwesomeIcons.regular),Array.isArray(window.FontAwesomeIcons.brands)&&e.push(...window.FontAwesomeIcons.brands),e.length>0)return e}const e=document.querySelectorAll('i[class*="fa-"]');if(e.length>0){const t=new Set;if(e.forEach(e=>{const o=e.className.split(" "),a=o.find(e=>e.startsWith("fa")||e.startsWith("fas")||e.startsWith("far")||e.startsWith("fab")),s=o.find(e=>e.startsWith("fa-"));a&&s&&t.add(`${a} ${s}`)}),t.size>0)return[...t]}return console.warn("‚ö†Ô∏è Font Awesome icons not available - using CSS classes only"),this.getFallbackFontAwesomeIcons()}catch(e){return console.error("Error getting Font Awesome icons:",e),this.getFallbackFontAwesomeIcons()}}showCustomImageInput(e,t){try{t.className="icon-picker-grid custom-input",t.textContent="";const o=document.createElement("div");o.className="custom-image-input-container";const a=document.createElement("label");a.setAttribute("for",`customImage${e}`),a.textContent="Enter Custom Image URL:";const s=document.createElement("input");s.type="text",s.id=`customImage${e}`,s.className="custom-image-url",s.placeholder="https://example.com/image.png",s.setAttribute("aria-label",`Custom image URL for ${e}`);const n=document.createElement("div");n.className="custom-image-preview",n.id=`preview${e}`,n.textContent="Image preview will appear here";const r=document.createElement("div");r.style.cssText="display: flex; gap: 10px; justify-content: center; margin-top: 15px;";const i=document.createElement("button");i.type="button",i.className="btn btn-primary",i.id=`applyBtn${e}`,i.disabled=!0,i.textContent="Apply Image",r.appendChild(i),o.appendChild(a),o.appendChild(s),o.appendChild(n),o.appendChild(r),t.appendChild(o);const l=document.getElementById(`customImage${e}`),c=document.getElementById(`preview${e}`),f=document.getElementById(`applyBtn${e}`);l&&c&&f&&(l.addEventListener("input",()=>{l._timer&&clearTimeout(l._timer),l._timer=setTimeout(()=>{const e=l.value.trim();if(e&&e.match(/^https?:\/\/.+\.(png|jpg|jpeg|gif|svg|webp)$/i)){c.textContent="Loading...";const t=new Image;t.onload=()=>{c.textContent="",c.appendChild(t),f.disabled=!1},t.onerror=()=>{c.textContent="Error loading image. Please check the URL.",f.disabled=!0},t.src=e,t.style.maxWidth="100%",t.style.maxHeight="100px"}else c.textContent="Enter valid image URL (must end with .png, .jpg, .gif, .svg, etc)",f.disabled=!0},500)}),f.addEventListener("click",()=>{const t=l.value.trim();t&&this.selectIcon(e,t,"custom")}),f.disabled=!0),console.log(`üñºÔ∏è Custom image input displayed for ${e}`)}catch(e){if(console.error("üö® Error showing custom image input:",e),t){t.textContent="";const e=document.createElement("div");e.style.cssText="padding: 20px; text-align: center; color: #666;";const o=document.createElement("p");o.textContent="Error loading custom image input";const a=document.createElement("button");a.className="btn btn-secondary",a.textContent="Switch back to Font Awesome",a.addEventListener("click",function(){const e=this.closest(".icon-picker-element"),t=e?.querySelector(".icon-picker-type");t&&(t.value="fontawesome",t.dispatchEvent(new Event("change")))}),e.appendChild(o),e.appendChild(a),t.appendChild(e)}}}populateIconGrid(e,t){try{const o=document.querySelector(`#iconGrid${e}`);if(!o)return;o.textContent="",o.className="icon-picker-grid loading",setTimeout(()=>{let a=[];if("fontawesome"===t)a=["fas fa-home","fas fa-search","fas fa-user","fas fa-cog","fas fa-image","fas fa-video","fas fa-file","fas fa-folder","fas fa-star","fas fa-heart","fas fa-check","fas fa-times","fas fa-plus","fas fa-minus","fas fa-circle","fas fa-square","fas fa-arrow-up","fas fa-arrow-down","fas fa-arrow-left","fas fa-arrow-right","fas fa-envelope","fas fa-phone","fas fa-map-marker","fas fa-calendar","fas fa-clock","fas fa-info-circle","fas fa-question-circle","fas fa-exclamation-circle","fas fa-bell","fas fa-bookmark","fas fa-camera","fas fa-link","fas fa-trash","fas fa-download","fas fa-upload","fas fa-edit","fas fa-save","fas fa-print","fas fa-eye","fas fa-eye-slash","fas fa-lock","fas fa-lock-open","fas fa-key","fas fa-cog","fas fa-wrench","fas fa-tools","fas fa-map","fas fa-location-arrow","fas fa-compass","fas fa-globe","fas fa-flag","fas fa-car","fas fa-bicycle","fas fa-bus","fas fa-truck","fas fa-plane","fas fa-rocket","fas fa-ship","fas fa-train","fas fa-subway","fas fa-taxi","fas fa-walking","fas fa-running","fas fa-hiking","fas fa-music","fas fa-headphones","fas fa-volume-up","fas fa-volume-down","fas fa-volume-off","fas fa-microphone","fas fa-photo-video","fas fa-film","fas fa-tv","fas fa-desktop","fas fa-laptop","fas fa-tablet","fas fa-mobile","fas fa-wifi","fas fa-broadcast-tower","fas fa-ethernet","fas fa-database","fas fa-server","fas fa-cloud","fas fa-cloud-upload-alt","fas fa-cloud-download-alt","fas fa-hdd","fas fa-memory","fas fa-microchip","fas fa-code","fas fa-terminal","fas fa-keyboard","fas fa-mouse","fas fa-gamepad","fas fa-share","fas fa-share-alt","fas fa-share-square","fas fa-reply","fas fa-reply-all","fas fa-forward","fas fa-undo","fas fa-redo","fas fa-sync","fas fa-spinner","fas fa-circle-notch","fas fa-ellipsis-h","fas fa-ellipsis-v","fas fa-bars","fas fa-list","fas fa-th","fas fa-th-large","fas fa-th-list","fas fa-filter","fas fa-sort","fas fa-sort-up","fas fa-sort-down","fas fa-chart-bar","fas fa-chart-line","fas fa-chart-pie","fas fa-chart-area","fas fa-coins","fas fa-dollar-sign","fas fa-euro-sign","fas fa-pound-sign","fas fa-yen-sign","fas fa-ruble-sign","fas fa-rupee-sign","fas fa-wallet","fas fa-credit-card","fas fa-money-bill","fas fa-money-check","fas fa-shopping-cart","fas fa-shopping-bag","fas fa-shopping-basket","fas fa-store","fas fa-box","fas fa-boxes","fas fa-archive","fas fa-warehouse","fas fa-tshirt","fas fa-shoe-prints","fas fa-user-tie","fas fa-mask","fas fa-glasses","fas fa-sunglasses","fas fa-briefcase","fas fa-suitcase","fas fa-umbrella","fas fa-hat-wizard","fas fa-crown","fas fa-graduation-cap","fas fa-book","fas fa-book-open","fas fa-atlas","fas fa-bookmark","fas fa-newspaper","fas fa-scroll","fas fa-pen","fas fa-pen-alt","fas fa-pen-fancy","fas fa-pen-nib","fas fa-marker","fas fa-highlighter","fas fa-pencil-alt","fas fa-eraser","fas fa-paint-brush","fas fa-paint-roller","fas fa-brush","fas fa-stamp","fas fa-tape","fas fa-paperclip","fas fa-thumbtack","fas fa-paste","fas fa-cut","fas fa-copy","fas fa-clipboard","fas fa-clipboard-check","fas fa-clipboard-list","fas fa-comment","fas fa-comment-alt","fas fa-comment-dots","fas fa-comments","fas fa-sms","fas fa-paper-plane","fas fa-envelope","fas fa-envelope-open","fas fa-mail-bulk","fas fa-inbox","fas fa-archive","fas fa-trash","fas fa-trash-alt","fas fa-trash-restore","fas fa-recycle","fas fa-fire","fas fa-fire-alt","fas fa-fire-flame-curved","fas fa-temperature-high","fas fa-temperature-low","fas fa-thermometer","fas fa-thermometer-full","fas fa-thermometer-half","fas fa-thermometer-empty","fas fa-tint","fas fa-tint-slash","fas fa-water","fas fa-hand-holding","fas fa-hands-wash","fas fa-shower","fas fa-bath","fas fa-toilet","fas fa-toilet-paper","fas fa-sink","fas fa-faucet","fas fa-pump-soap","fas fa-band-aid","fas fa-first-aid","fas fa-medkit","fas fa-stethoscope","fas fa-user-md","fas fa-user-nurse","fas fa-hospital","fas fa-hospital-alt","fas fa-hospital-user","fas fa-clinic-medical","fas fa-heartbeat","fas fa-heart-broken","fas fa-virus","fas fa-virus-slash","fas fa-viruses","fas fa-bacteria","fas fa-disease","fas fa-pills","fas fa-prescription","fas fa-cannabis","fas fa-smoking","fas fa-smoking-ban","fas fa-leaf","fas fa-prescription-bottle","fas fa-capsules","fas fa-tablets","fas fa-beer","fas fa-cocktail","fas fa-wine-glass","fas fa-wine-glass-alt","fas fa-wine-bottle","fas fa-whiskey-glass","fas fa-glass-martini","fas fa-glass-martini-alt","fas fa-glass-whiskey","fas fa-flask","fas fa-vial","fas fa-vials","fas fa-capsules","fas fa-tablets","fas fa-prescription-bottle","fas fa-prescription-bottle-alt","fas fa-mortar-pestle","fas fa-syringe","fas fa-tablets","fas fa-teeth","fas fa-teeth-open","fas fa-tooth","fas fa-bone","fas fa-user-injured","fas fa-wheelchair","fas fa-crutch","fas fa-poop","fas fa-toilet-paper","fas fa-hand-sparkles","fas fa-hands-wash","fas fa-handshake-alt-slash","fas fa-people-arrows","fas fa-mask","fas fa-head-side-cough","fas fa-head-side-cough-slash","fas fa-head-side-mask","fas fa-head-side-virus","fas fa-people-arrows","fas fa-person-booth","fas fa-route","fas fa-map-marked","fas fa-map-marked-alt","fas fa-home","fas fa-house-user","far fa-circle","far fa-square","far fa-star","far fa-heart","far fa-user","far fa-file","far fa-folder","far fa-calendar","far fa-clock","far fa-bell","far fa-bookmark","far fa-envelope","far fa-eye","far fa-eye-slash","far fa-comment","fab fa-facebook","fab fa-twitter","fab fa-instagram","fab fa-youtube","fab fa-google","fab fa-github","fab fa-linkedin","fab fa-apple","fab fa-android","fab fa-windows","fab fa-amazon","fab fa-spotify","fab fa-discord"],a=[...new Set(a)];else if("emoji"===t)a=this.getConsistentEmojiSet();else if("custom"===t)return void this.showCustomImageInput(e,o);if(0===a.length){o.className="icon-picker-grid empty",o.textContent="";const e=document.createElement("p");return e.style.cssText="color: #666; text-align: center; padding: 20px;",e.textContent="No icons available",void o.appendChild(e)}o.className="icon-picker-grid",a.slice(0,240).forEach(a=>{const s=document.createElement("div");if(s.className=`icon-item ${t}`,s.dataset.icon=a,s.dataset.element=e,s.tabIndex=0,s.setAttribute("role","button"),s.setAttribute("aria-label",`Select ${a} for ${e}`),"fontawesome"===t){const e=document.createElement("i");e.className=a,e.setAttribute("aria-hidden","true"),s.appendChild(e)}else s.textContent=a;s.addEventListener("click",()=>{this.selectIcon(e,a,t)}),s.addEventListener("keydown",o=>{"Enter"!==o.key&&" "!==o.key||(o.preventDefault(),this.selectIcon(e,a,t))}),o.appendChild(s)}),this.highlightSelectedIcon(e,o)},100)}catch(e){if(console.error("üö® Error populating icon grid:",e),gridContainer){gridContainer.className="icon-picker-grid empty",gridContainer.textContent="";const e=document.createElement("p");e.style.cssText="color: red; text-align: center; padding: 20px;",e.textContent="Error loading icons",gridContainer.appendChild(e)}}}selectIcon(e,t,o){try{const a=`thumbnailSettings.iconSettings.customIcons.${e}`;this.core.safeSetNestedProperty(this.core.config,a,t),this.updateCurrentIconDisplay(e,t,o);const s=document.querySelector(`#iconGrid${e}`);s&&this.highlightSelectedIcon(e,s,t);const n=document.querySelector(`.icon-picker-element[data-element="${e}"]`);n&&(n.classList.add("updating"),setTimeout(()=>{n.classList.remove("updating"),n.classList.add("updated"),setTimeout(()=>{n.classList.remove("updated")},2e3)},500)),this.core.showToast&&this.core.showToast("success","Icon Updated",`${e} icon changed to ${"custom"===o?"custom image":t}`),console.log(`üé® Selected icon for ${e}: ${t}`)}catch(e){console.error("üö® Error selecting icon:",e)}}updateCurrentIconDisplay(e,t=null,o=null){try{const a=document.querySelector(`#currentIcon${e}`);if(!a)return;if(t||(t=this.core.getNestedProperty(this.core.config,`thumbnailSettings.iconSettings.customIcons.${e}`)||"fas fa-circle"),o||(o=t.startsWith("fas ")||t.startsWith("far ")||t.startsWith("fab ")?"fontawesome":t.match(/^https?:\/\//i)?"custom":"emoji"),"fontawesome"===o){a.textContent="";const e=document.createElement("i");e.className=t,e.setAttribute("aria-hidden","true"),a.appendChild(e)}else if("custom"===o){a.textContent="";const e=document.createElement("img");e.src=t,e.alt="Custom icon",e.addEventListener("error",function(){this.src='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="%23f44336" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>'}),a.appendChild(e)}else a.textContent=t}catch(e){console.error("üö® Error updating current icon display:",e)}}highlightSelectedIcon(e,t,o=null){try{if(o||(o=this.core.getNestedProperty(this.core.config,`thumbnailSettings.iconSettings.customIcons.${e}`)),t.querySelectorAll(".icon-item.selected").forEach(e=>{e.classList.remove("selected")}),o){const e=t.querySelector(`[data-icon="${o}"]`);e&&(e.classList.add("selected"),e.offsetTop>t.clientHeight&&(t.scrollTop=e.offsetTop-t.clientHeight/2))}}catch(e){console.error("üö® Error highlighting selected icon:",e)}}populateIconForm(e){try{const t=this.core.config.thumbnailSettings?.iconSettings||{},o=e.querySelector("#enableCustomIcons");o&&(o.checked=!!t.enableCustomIcons);const a=e.querySelector("#enableFontAwesome");a&&(a.checked=!!t.enableFontAwesome);const s=e.querySelector("#fontAwesomeUrl");s&&t.fontAwesomeUrl&&(s.value=t.fontAwesomeUrl);const n=e.querySelector("#iconSize");n&&t.iconSize&&(n.value=t.iconSize);const r=e.querySelector("#iconColor"),i=e.querySelector("#iconColor + .color-hex-input");r&&t.iconColor&&(r.value=t.iconColor,i&&(i.value=t.iconColor.toUpperCase()));const l=e.querySelector("#iconOpacity"),c=e.querySelector("#iconOpacity + .range-value");l&&void 0!==t.iconOpacity&&(l.value=t.iconOpacity,c&&(c.textContent=t.iconOpacity));const f=e.querySelector("#iconAlignment");f&&t.iconAlignment&&(f.value=t.iconAlignment);const d=e.querySelector("#iconMargin");d&&void 0!==t.iconMargin&&(d.value=t.iconMargin);const u=e.querySelector("#enableIconHover");u&&(u.checked=!!t.enableIconHover);const h=e.querySelector("#iconHoverScale");h&&void 0!==t.iconHoverScale&&(h.value=t.iconHoverScale,this.updateRangeValue(h));const g=e.querySelector("#iconHoverOpacity");g&&void 0!==t.iconHoverOpacity&&(g.value=t.iconHoverOpacity),this.handleIconSystemToggle(),["Panorama","Hotspot","Polygon","Video","Webframe","Image","Text","ProjectedImage","Element","Business","3DHotspot","Container","3DModel","3DModelObject"].forEach(e=>{this.updateCurrentIconDisplay(e)}),console.log("üé® Icon form populated")}catch(e){console.error("üö® Security: Error populating icon form:",e)}}setupGlobalDefaultPathHandler(e){try{const t=e.querySelector("#thumbnailDefaultPath"),o=e.querySelector(".btn-secondary");if(!t||!o)return;const a=document.createElement("input");a.type="file",a.accept="image/*",a.style.display="none",a.id="thumbnailFileInput",t.parentNode.appendChild(a),o.addEventListener("click",()=>{a.click()}),a.addEventListener("change",e=>{this.handleImageUpload(e.target,t)}),this.createImagePreview(t.parentNode),console.log("üìÅ Global Default Path handler set up")}catch(e){console.error("üö® Security: Error setting up global default path handler:",e)}}createImagePreview(e){try{if(e.querySelector(".image-preview-container"))return;const t=document.createElement("div");t.className="image-preview-container",t.textContent="";const o=document.createElement("div");o.className="image-preview-label",o.textContent="Preview";const a=document.createElement("img");a.className="image-preview",a.src="",a.alt="Thumbnail preview",a.style.display="none";const s=document.createElement("div");s.className="preview-placeholder",s.textContent="No image",t.appendChild(o),t.appendChild(a),t.appendChild(s),e.insertBefore(t,e.firstChild)}catch(e){console.error("üö® Security: Error creating image preview:",e)}}handleImageUpload(e,t){try{const o=e.files[0];if(!o)return;if(!["image/jpeg","image/png","image/gif","image/webp","image/svg+xml"].includes(o.type))return void(this.core.showToast&&this.core.showToast("error","Invalid File","Please select a valid image file (JPG, PNG, GIF, WEBP, SVG)"));const a=2097152;if(o.size>a)return void(this.core.showToast&&this.core.showToast("error","File Too Large","Image must be smaller than 2MB"));const s=o.name.replace(/[^a-zA-Z0-9._-]/g,"");t.value=`assets/${s}`,this.core.onFormChange(t);const n=new FileReader;n.onload=e=>{this.showImagePreview(e.target.result,t.parentNode)},n.readAsDataURL(o),this.core.showToast&&this.core.showToast("success","Image Selected","Image will be uploaded when settings are saved")}catch(e){console.error("üö® Security: Error handling image upload:",e)}}showImagePreview(e,t){try{const o=t.querySelector(".image-preview-container");if(!o)return;const a=o.querySelector(".image-preview"),s=o.querySelector(".preview-placeholder");a&&s&&(a.src=e,a.style.display="block",s.style.display="none")}catch(e){console.error("üö® Security: Error showing image preview:",e)}}updateRangeValue(e){try{const t=e.parentNode.querySelector(".range-value");t&&(t.textContent=e.value);const o=parseFloat(e.min)||0,a=parseFloat(e.max)||100,s=((parseFloat(e.value)||0)-o)/(a-o)*100;e.style.background=`linear-gradient(to right, var(--color-primary) 0%, var(--color-primary) ${s}%, var(--color-surface-secondary) ${s}%, var(--color-surface-secondary) 100%)`,console.log(`üéöÔ∏è Range value updated: ${e.id} = ${e.value}`)}catch(e){console.error("üö® Error updating range value:",e)}}populateThumbnailForm(e){try{const t=this.core.config.thumbnailSettings||{},o=e.querySelector("#enableThumbnails");o&&(o.checked=!!t.enableThumbnails,this.handleThumbnailToggle(o));const a=e.querySelector("#thumbnailSizePreset");a&&t.thumbnailSize&&(a.value=t.thumbnailSize);const s=e.querySelector("#thumbnailBorderRadius"),n=e.querySelector("#thumbnailBorderRadius + .range-value");s&&void 0!==t.borderRadius&&(s.value=t.borderRadius,n&&(n.textContent=t.borderRadius));const r=e.querySelector("#thumbnailBorderWidth"),i=e.querySelector("#thumbnailBorderWidth + .range-value");r&&void 0!==t.borderWidth&&(r.value=t.borderWidth,i&&(i.textContent=t.borderWidth));const l=e.querySelector("#thumbnailBorderColor"),c=e.querySelector("#thumbnailBorderColor + .color-hex-input");l&&t.borderColor&&(l.value=t.borderColor,c&&(c.value=t.borderColor.toUpperCase()));const f=e.querySelector("#thumbnailDefaultPath");f&&t.defaultImagePath&&(f.value=t.defaultImagePath,this.loadExistingImagePreview(t.defaultImagePath,f.parentNode));const d=t.defaultImages||{},u={Panorama:"panoramaDefault",Hotspot:"hotspotDefault",Polygon:"polygonDefault",Video:"videoDefault",Webframe:"webframeDefault",Image:"imageDefault",Text:"textDefault",ProjectedImage:"projectedImageDefault",Element:"elementDefault",Business:"businessDefault","3DHotspot":"3dHotspotDefault",Container:"containerDefault","3DModel":"3dModelDefault","3DModelObject":"3dModelObjectDefault"};Object.entries(d).forEach(([e,t])=>{const o=u[e];if(o){const a=document.getElementById(o);if(a){const e=window.searchProControlPanel?.core||this.core,s=e?.stripAssetPrefix?e.stripAssetPrefix(t):this.filenameOnly(t);a.value=s,a.setAttribute("value",s),console.log(`üîß POPULATE: Set ${o} = ${s} (from ${t})`)}else console.warn(`üîß POPULATE: Input ${o} not found for element ${e}`)}}),console.log("üñºÔ∏è Thumbnail form populated")}catch(e){console.error("üö® Security: Error populating thumbnail form:",e)}}loadExistingImagePreview(e,t){try{if(!e)return;const o=new Image;o.onload=()=>{this.showImagePreview(o.src,t)},o.onerror=()=>{console.log("Image not found, hiding preview")},o.src=e}catch(e){console.error("üö® Security: Error loading existing image preview:",e)}}resetThumbnailToDefaults(){try{const e={enableThumbnails:!1,thumbnailSize:"48px",borderRadius:4,borderColor:"#9CBBFF",borderWidth:4,defaultImagePath:"assets/default-thumbnail.jpg",defaultImages:{Panorama:"assets/default-thumbnail.jpg",Hotspot:"assets/hotspot-default.jpg",Polygon:"assets/polygon-default.jpg",Video:"assets/video-default.jpg",Webframe:"assets/webframe-default.jpg",Image:"assets/image-default.jpg",Text:"assets/text-default.jpg",ProjectedImage:"assets/projected-image-default.jpg",Element:"assets/element-default.jpg",Business:"assets/business-default.jpg",Container:"assets/container-default.jpg","3DModel":"assets/3d-model-default.jpg","3DHotspot":"assets/3d-hotspot-default.jpg","3DModelObject":"assets/3d-model-object-default.jpg"}};this.core.config.thumbnailSettings={...e};const t=document.getElementById("display-panel");t&&this.populateThumbnailForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","All thumbnail settings reset to defaults")}catch(e){console.error("Error resetting thumbnail settings:",e)}}resetIconSettingsToDefaults(){try{const e={enableCustomIcons:!1,enableFontAwesome:!1,fontAwesomeUrl:"",iconSize:"24px",iconColor:"#3b82f6",iconOpacity:1,iconAlignment:"left"};this.core.config.thumbnailSettings||(this.core.config.thumbnailSettings={}),this.core.config.thumbnailSettings.iconSettings||(this.core.config.thumbnailSettings.iconSettings={}),Object.assign(this.core.config.thumbnailSettings.iconSettings,e);const t=document.getElementById("display-panel");t&&this.populateIconForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","All icon settings reset to defaults")}catch(e){console.error("‚ùå Error resetting icon settings:",e)}}resetLabelFallbackToDefaults(){try{const e=this.core.getDefaultConfig().useAsLabel||{};this.core.config.useAsLabel={...e};const t=document.getElementById("display-panel");t&&this.populateDisplayForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Label fallback options reset to defaults"),console.log("üîÑ Label fallback options reset to defaults")}catch(e){console.error("üö® Security: Error resetting label fallback options:",e)}}resetLabelCustomizationToDefaults(){try{const e={Panorama:"Panorama",Hotspot:"Hotspot",Polygon:"Polygon",Video:"Video",Webframe:"Webframe",Image:"Image",Text:"Text",ProjectedImage:"Projected Image",Element:"Element",Business:"Business","3DHotspot":"3D Hotspot","3DModel":"3D Model","3DModelObject":"3D Model Object",Container:"Container"};this.core.config.displayLabels||(this.core.config.displayLabels={});for(const t in e)this.core.config.displayLabels[t]=e[t];const t=document.getElementById("display-panel");t&&this.populateLabelCustomizationForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Label customization reset to defaults"),console.log("üè∑Ô∏è Label customization reset to defaults")}catch(e){console.error("üö® Security: Error resetting label customization:",e)}}handleThumbnailToggle(e){try{const t=e.checked,o=document.getElementById("thumbnailSettings");o&&(t?(o.style.display="block",o.style.opacity="1"):(o.style.display="none",o.style.opacity="0"));const a=document.getElementById("thumbnailPriorityInfo");a&&(t?(a.style.display="flex",a.style.opacity="1"):(a.style.display="none",a.style.opacity="0")),this.core.onFormChange(e),console.log("üñºÔ∏è Thumbnails "+(t?"enabled":"disabled"))}catch(e){console.error("üö® Security: Error handling thumbnail toggle:",e)}}handleColorInputChange(e){try{const t=e.closest(".color-input-wrapper").querySelector(".color-hex-input");t&&(t.value=e.value.toUpperCase(),this.core.validateField(t)),this.core.onFormChange(e)}catch(e){console.error("üö® Security: Error handling color input:",e)}}handleHexInputChange(e){try{const t=e.value;if(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(t)){const o=e.closest(".color-input-wrapper").querySelector(".color-input");o&&(o.value=t,this.core.onFormChange(o)),e.classList.remove("error")}else e.classList.add("error")}catch(e){console.error("üö® Security: Error handling hex input:",e)}}populateSubtitleToggles(){try{const e=document.getElementById("showSubtitlesInResults");if(!e)return;const t=this.core.config.display||{};e.checked=!!t.showSubtitlesInResults,console.log(`üëÅÔ∏è Subtitle toggles populated: showSubtitles=${e.checked}`)}catch(e){console.error("üö® Security: Error populating subtitle toggles:",e)}}handleDisplayBehaviorToggle(e){try{const t=this.core.sanitizeInput(e.name||e.id,100),o=e.checked;this.core.onFormChange(e),this.applyDisplayLivePreview(t,o),this.showToggleFeedback(e,o),console.log(`üëÅÔ∏è Display toggle changed: ${t} = ${o}`)}catch(e){console.error("üö® Security: Error handling display behavior toggle:",e)}}isSubtitleToggle(e){return"showSubtitlesInResults"===e||"display.showSubtitlesInResults"===e}onFormChange(e,t=!1){try{const t=e.name||e.id;this.core.onFormChange(e),(t.startsWith("display.")||["showGroupHeaders","showGroupCount","showIconsInResults","showTagsInResults","showParentInfo"].includes(t))&&this.handleDisplayBehaviorToggle(e)}catch(e){console.error("üö® Security: Error handling Display tab form change:",e)}}resetToDefaults(){try{console.log("üîÑ Resetting Display tab to defaults");const e=this.core.getDefaultConfig();e.display?this.core.config.display={...e.display}:this.core.config.display={showGroupHeaders:!0,showGroupCount:!0,showIconsInResults:!0,showTagsInResults:!0,showSubtitlesInResults:!0,showParentInfo:!0},e.thumbnailSettings&&(this.core.config.thumbnailSettings={...e.thumbnailSettings},this.core.config.thumbnailSettings.enableThumbnails=!1),this.core.safeSetNestedProperty(this.core.config,"elementContent.showDescriptions",!0);const t=document.getElementById("display-panel");t&&(this.populateDisplayForm(t),this.setupDisplayBehaviorHandlers(t),this.setupThumbnailHandlers(t)),console.log("‚úÖ Display tab reset complete")}catch(e){console.error("üö® Security: Error resetting Display tab:",e)}}resetDisplayBehaviorToDefaults(){try{const e={showGroupHeaders:!0,showGroupCount:!0,showIconsInResults:!0,showTagsInResults:!0,showSubtitlesInResults:!0,showParentInfo:!0};this.core.config.display||(this.core.config.display={}),Object.keys(e).forEach(t=>{this.core.safeSetNestedProperty(this.core.config.display,t,e[t])});const t=document.getElementById("display-panel");t&&this.populateDisplayForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Display behavior reset to defaults"),console.log("üîÑ Display behavior settings reset to defaults")}catch(e){console.error("üö® Security: Error resetting display behavior:",e)}}resetThumbnailVisibilityToggles(){try{const e={panorama:!0,hotspot:!0,polygon:!0,video:!0,webframe:!0,image:!0,text:!0,projectedImage:!0,element:!0,business:!0,container:!0,"3dmodel":!0,"3dhotspot":!0,"3dmodelobject":!0,other:!0};this.core.config.displayElements||(this.core.config.displayElements={}),this.core.config.displayElements.showFor||(this.core.config.displayElements.showFor={}),Object.keys(e).forEach(t=>{this.core.config.displayElements.showFor[t]=e[t];const o=document.querySelector(`[name="displayElements.showFor.${t}"]`);if(o){o.checked=e[t];const a=new Event("change",{bubbles:!0,cancelable:!0});o.dispatchEvent(a)}}),this.core.showToast&&this.core.showToast("success","Reset Complete","Thumbnail visibility toggles reset to defaults")}catch(e){console.error("Error resetting thumbnail visibility toggles:",e)}}updateToggleVisualState(e,t){try{const o=e.closest(".form-group");if(!o)return;o.classList.add("auto-changed"),setTimeout(()=>{o.classList.remove("auto-changed")},600);const a=o.querySelector(".toggle-text");a&&(a.style.color="#8b5cf6",setTimeout(()=>{a.style.color=t?"#38A169":"#E53E3E",setTimeout(()=>{a.style.color=""},1e3)},300))}catch(e){console.error("üö® Error updating toggle visual state:",e)}}showInterdependencyMessage(e){try{this.core&&this.core.showToast?this.core.showToast("info","Auto-adjustment",e):console.log(`‚ÑπÔ∏è ${e}`)}catch(e){console.error("üö® Error showing interdependency message:",e)}}showToggleFeedback(e,t){try{const o=e.closest(".form-group");if(!o)return;o.classList.add("just-changed"),setTimeout(()=>{o.classList.remove("just-changed")},300);const a=o.querySelector(".toggle-text");a&&(a.style.color=t?"#38A169":"#E53E3E",setTimeout(()=>{a.style.color=""},1e3))}catch(e){console.error("üö® Error showing toggle feedback:",e)}}validateField(e){try{const t="checkbox"===e.type?e.checked:e.value,o=this.core.sanitizeInput(e.name||e.id,100);let a=!0;if(a=this.core.validateField(e),"thumbnailBorderRadius"===e.id)a=this.validateBorderRadius(e,t);else if("thumbnailBorderWidth"===e.id)a=this.validateBorderWidth(e,t);else if("iconSize"===e.id)a=this.validateIconSize(e);else if("thumbnailDefaultPath"===e.id){if(e.value&&e.value.trim()){const t=this.toAssetPath(e.value);t!==e.value&&(e.value=t,e.dispatchEvent(new Event("change",{bubbles:!0})))}}else if(e.id?.endsWith("Default")){const t=this.filenameOnly(e.value);t!==e.value&&(e.value=t,e.setAttribute("value",t),e.dispatchEvent(new Event("change",{bubbles:!0})))}return a?(e.classList.remove("error"),e.classList.add("valid")):(e.classList.add("error"),console.log(`‚ö†Ô∏è Display tab validation: ${o} failed`)),a}catch(e){return console.error("üö® Security: Error in Display tab field validation:",e),!1}}validateIconSize(e){try{const t=e.value,o=document.querySelector("#iconSizeWarning"),a=document.querySelector("#iconSizeError");if(!o||!a)return!0;o.style.display="none",a.style.display="none";let s=48;return t&&t.endsWith("px")&&(s=parseInt(t.replace("px",""))),s<16||s>96?(a.style.display="block",e.classList.add("error"),!1):s>=64?(o.style.display="block",e.classList.remove("error"),e.classList.add("warning"),!0):(e.classList.remove("error","warning"),!0)}catch(e){return console.error("Error validating icon size:",e),!1}}validateBorderRadius(e,t){try{const o=parseFloat(t);return this.clearValidationMessage(e),isNaN(o)||o<0?(this.showValidationMessage(e,"error","Border radius cannot be negative"),!1):o>50?(this.showValidationMessage(e,"error","Border radius cannot exceed 50px"),!1):(o>35&&this.showValidationMessage(e,"warning","High border radius values may look unusual on small thumbnails"),!0)}catch(e){return console.error("Error validating border radius:",e),!1}}validateBorderWidth(e,t){try{const o=parseFloat(t);return this.clearValidationMessage(e),isNaN(o)||o<0?(this.showValidationMessage(e,"error","Border width cannot be negative"),!1):o>10?(this.showValidationMessage(e,"error","Border width cannot exceed 10px"),!1):(o>5&&this.showValidationMessage(e,"warning","Thick borders may reduce visible thumbnail content"),!0)}catch(e){return console.error("Error validating border width:",e),!1}}showValidationMessage(e,t,o,a=3e3){try{if("function"==typeof window.showValidationMessage)return void window.showValidationMessage(e,t,o,a);this.clearValidationMessage(e);const s=document.createElement("div");s.className=`validation-message validation-${t}`,s.textContent=o,s.id=`${e.id}-validation`,s.style.cssText=`\n        position: absolute;\n        top: 100%;\n        left: 0;\n        background: ${"error"===t?"#ef4444":"#f59e0b"};\n        color: white;\n        padding: 4px 8px;\n        border-radius: 4px;\n        font-size: 12px;\n        z-index: 1000;\n        white-space: nowrap;\n        margin-top: 2px;\n      `,e.parentNode.style.position="relative",e.parentNode.appendChild(s),setTimeout(()=>{this.clearValidationMessage(e)},a),console.log(`üëÅÔ∏è Validation message shown: ${t} - ${o}`)}catch(e){console.error("Error showing validation message:",e)}}clearValidationMessage(e){try{if("function"==typeof window.clearValidationMessage)return void window.clearValidationMessage(e.id);const t=document.getElementById(`${e.id}-validation`);t&&t.remove()}catch(e){console.error("Error clearing validation message:",e)}}validateForm(e=document){try{const t=e.querySelectorAll(".form-input, .toggle-input, .range-input, .form-select");let o=!0;return t.forEach(e=>{this.validateField(e)||(o=!1)}),console.log("üëÅÔ∏è Display tab validation: "+(o?"PASSED":"FAILED")),o}catch(e){return console.error("üö® Security: Error validating Display tab form:",e),!1}}applyDisplayLivePreview(e,t){try{const o=JSON.parse(JSON.stringify(this.core.config));if(this.core.safeSetNestedProperty(o,e,t),this.core.safeLocalStorageSet("searchProLiveConfig",o),window.parent&&window.parent!==window)try{window.parent.postMessage({type:"searchProConfigPreview",config:o,field:this.core.sanitizeInput(e),value:"string"==typeof t?this.core.sanitizeInput(t):t,section:"display"},"*")}catch(e){console.warn("üö® Security: Error posting message to parent:",e)}console.log(`üëÅÔ∏è Display live preview: ${e} = ${t}`)}catch(e){console.warn("üö® Security: Display tab live preview failed:",e)}}getConfigSummary(){try{return{tab:"Display",sections:{display:{showGroupHeaders:this.core.config.display?.showGroupHeaders||!0,showGroupCount:this.core.config.display?.showGroupCount||!0,showIconsInResults:this.core.config.display?.showIconsInResults||!0,showTagsInResults:this.core.config.display?.showTagsInResults||!0,showSubtitlesInResults:this.core.config.display?.showSubtitlesInResults||!0,showParentInfo:this.core.config.display?.showParentInfo||!0},thumbnailSettings:{enableThumbnails:this.core.config.thumbnailSettings?.enableThumbnails||!1,thumbnailSize:this.core.config.thumbnailSettings?.thumbnailSize||"48px",borderRadius:this.core.config.thumbnailSettings?.borderRadius||4,borderWidth:this.core.config.thumbnailSettings?.borderWidth||4,borderColor:this.core.config.thumbnailSettings?.borderColor||"#9CBBFF",defaultImagePath:this.core.config.thumbnailSettings?.defaultImagePath||"assets/default-thumbnail.jpg",defaultImages:this.core.config.thumbnailSettings?.defaultImages||{}},iconSettings:{enableCustomIcons:this.core.config.thumbnailSettings?.iconSettings?.enableCustomIcons||!1,enableFontAwesome:this.core.config.thumbnailSettings?.iconSettings?.enableFontAwesome||!1,fontAwesomeUrl:this.core.config.thumbnailSettings?.iconSettings?.fontAwesomeUrl||"",iconSize:this.core.config.thumbnailSettings?.iconSettings?.iconSize||"24px",iconColor:this.core.config.thumbnailSettings?.iconSettings?.iconColor||"#3b82f6",iconOpacity:this.core.config.thumbnailSettings?.iconSettings?.iconOpacity||1,iconAlignment:this.core.config.thumbnailSettings?.iconSettings?.iconAlignment||"left"}}}}catch(e){return console.error("üö® Security: Error getting Display tab config summary:",e),null}}syncIconColors(e){try{const t=document.querySelector("#resultIconColor"),o=document.querySelector("#resultIconColor + .color-hex-input");t&&(t.value=e,this.core.setNestedValue(this.core.config,"appearance.colors.resultIconColor",e)),o&&(o.value=e.toUpperCase()),console.log(`üé® Synced Icon Color with Result Icon Color: ${e}`)}catch(e){console.error("Error syncing icon colors:",e)}}cleanup(){try{this.hideAllTooltips(),console.log("üßπ Display tab handler cleaned up")}catch(e){console.error("üö® Security: Error cleaning up Display tab:",e)}}setupFontAwesomeIcons(){try{if(document.querySelector('link[href*="fontawesome"]'))return void console.log("‚úÖ Font Awesome already loaded");const e=document.createElement("link");e.rel="stylesheet",e.href="./fontawesome/css/all.min.css",document.head.appendChild(e),console.log("‚úÖ Font Awesome CSS loaded");const t=document.createElement("script");t.src="./fontawesome/js/all.min.js",t.async=!0,document.head.appendChild(t)}catch(e){console.error("üö® Error setting up Font Awesome:",e)}}getIconFallbacks(){return{solid:["fas fa-home","fas fa-search","fas fa-user","fas fa-cog","fas fa-image","fas fa-video","fas fa-file","fas fa-folder","fas fa-star","fas fa-heart","fas fa-check","fas fa-times","fas fa-plus","fas fa-minus","fas fa-circle","fas fa-square","fas fa-arrow-up","fas fa-arrow-down","fas fa-arrow-left","fas fa-arrow-right","fas fa-envelope","fas fa-phone","fas fa-map-marker","fas fa-calendar","fas fa-clock","fas fa-info-circle","fas fa-question-circle","fas fa-exclamation-circle","fas fa-bell","fas fa-bookmark","fas fa-camera","fas fa-link","fas fa-trash","fas fa-download","fas fa-upload","fas fa-edit"],regular:["far fa-circle","far fa-square","far fa-star","far fa-heart","far fa-user","far fa-file","far fa-folder","far fa-calendar","far fa-clock","far fa-bell","far fa-bookmark","far fa-envelope"],brands:["fab fa-facebook","fab fa-twitter","fab fa-instagram","fab fa-youtube","fab fa-google","fab fa-github","fab fa-linkedin","fab fa-apple"],fallbacks:{"fa-photo":"fas fa-image","fas fa-photo":"fas fa-image","fa-picture":"fas fa-image","fas fa-picture":"fas fa-image","fa-restaurant":"fas fa-utensils","fas fa-restaurant":"fas fa-utensils","fa-cloud-snow":"fas fa-snowflake","fas fa-cloud-snow":"fas fa-snowflake"}}}updateConfigFromForm(e){try{e.querySelectorAll("[name]").forEach(e=>{const t=e.getAttribute("name");if(!t)return;let o;o="checkbox"===e.type?e.checked:"number"===e.type||"range"===e.type?""===e.value?null:parseFloat(e.value):(e.type,e.value),t.includes("displayElements.showFor")&&(console.log(`üîß THUMBNAIL VISIBILITY: ${t} = ${o}`),console.log("üîß CONFIG STATE: displayElements.showFor =",this.core.config.displayElements?.showFor)),this.core.safeSetNestedProperty(this.core.config,t,o)});const t={panoramaLabel:"Panorama",hotspotLabel:"Hotspot",polygonLabel:"Polygon",videoLabel:"Video",webframeLabel:"Webframe",imageLabel:"Image",textLabel:"Text",projectedImageLabel:"ProjectedImage",elementLabel:"Element",businessLabel:"Business","3dHotspotLabel":"3DHotspot","3dModelLabel":"3DModel","3dModelObjectLabel":"3DModelObject",containerLabel:"Container"};Object.keys(t).forEach(o=>{const a=o.startsWith("3d")?e.querySelector(`[id="${o}"]`):e.querySelector(`#${o}`);a&&a.value&&(this.core.config.displayLabels||(this.core.config.displayLabels={}),this.core.config.displayLabels[t[o]]=a.value)}),this.updateIconConfigFromForm(e),this.updateThumbnailConfigFromForm(e),console.log("üëÅÔ∏è Display tab config updated from form")}catch(e){console.error("üö® Security: Error updating config from Display tab form:",e)}}updateIconConfigFromForm(e){try{const e=this.core.config.thumbnailSettings?.iconSettings;if(!e)return;["Panorama","Hotspot","Polygon","Video","Webframe","Image","Text","ProjectedImage","Element","Business","3DHotspot","Container","3DModel","3DModelObject"].forEach(e=>{this.core.getNestedProperty(this.core.config,`thumbnailSettings.iconSettings.customIcons.${e}`)}),console.log("üé® Icon config updated from form")}catch(e){console.error("üö® Error updating icon config from form:",e)}}updateThumbnailConfigFromForm(e){try{const e={Panorama:"panoramaDefault",Hotspot:"hotspotDefault",Polygon:"polygonDefault",Video:"videoDefault",Webframe:"webframeDefault",Image:"imageDefault",Text:"textDefault",ProjectedImage:"projectedImageDefault",Element:"elementDefault",Business:"businessDefault","3DHotspot":"3dHotspotDefault",Container:"containerDefault","3DModel":"3dModelDefault","3DModelObject":"3dModelObjectDefault"};console.log("üîß FORM DEBUG: updateThumbnailConfigFromForm called"),Object.entries(e).forEach(([e,t])=>{const o=document.getElementById(t);if(console.log(`üîß FORM DEBUG: Checking ${e}Default input:`,{element:e,inputExists:!!o,inputValue:o?.value,inputId:o?.id}),o&&o.value){this.core.config.thumbnailSettings||(this.core.config.thumbnailSettings={}),this.core.config.thumbnailSettings.defaultImages||(this.core.config.thumbnailSettings.defaultImages={});const t=this.toAssetPath(o.value);this.core.config.thumbnailSettings.defaultImages[e]=t,console.log(`üñºÔ∏è Processed ${e} path: ${o.value} -> ${t}`)}}),console.log("üñºÔ∏è Thumbnail config updated from form"),console.log("üîç DEBUG - Current thumbnail settings:",{enableThumbnails:this.core.config.thumbnailSettings?.enableThumbnails,defaultImages:this.core.config.thumbnailSettings?.defaultImages,showFor:this.core.config.thumbnailSettings?.showFor,displayElementsShowFor:this.core.config.displayElements?.showFor})}catch(e){console.error("üö® Error updating thumbnail config from form:",e)}}updateDisplayConfigFromForm(e){try{const e=document.getElementById("enableThumbnails");e&&(this.core.config.thumbnailSettings||(this.core.config.thumbnailSettings={}),this.core.config.thumbnailSettings.enableThumbnails=e.checked,console.log(`üîß DISPLAY CONFIG: enableThumbnails = ${e.checked}`));const t=document.getElementById("thumbnailSizePreset");t&&t.value&&(this.core.config.thumbnailSettings.thumbnailSize=t.value,console.log(`üîß DISPLAY CONFIG: thumbnailSize = ${t.value}`));const o=document.getElementById("thumbnailBorderRadius");o&&(this.core.config.thumbnailSettings.borderRadius=parseInt(o.value)||0,console.log(`üîß DISPLAY CONFIG: borderRadius = ${o.value}`));const a=document.getElementById("thumbnailBorderWidth");if(a&&(this.core.config.thumbnailSettings.borderWidth=parseInt(a.value)||0,console.log(`üîß DISPLAY CONFIG: borderWidth = ${a.value}`)),this.core.config.thumbnailSettings.showFor||(this.core.config.thumbnailSettings.showFor={}),console.log("üîß DEBUG: Checking displayElements.showFor:",this.core.config.displayElements?.showFor),this.core.config.displayElements?.showFor){const e={panorama:this.core.config.displayElements.showFor.panorama,hotspot:this.core.config.displayElements.showFor.hotspot,polygon:this.core.config.displayElements.showFor.polygon,video:this.core.config.displayElements.showFor.video,webframe:this.core.config.displayElements.showFor.webframe,image:this.core.config.displayElements.showFor.image,text:this.core.config.displayElements.showFor.text,projectedimage:this.core.config.displayElements.showFor.projectedImage,element:this.core.config.displayElements.showFor.element,business:this.core.config.displayElements.showFor.business,container:this.core.config.displayElements.showFor.container,"3dmodel":this.core.config.displayElements.showFor["3dmodel"],"3dhotspot":this.core.config.displayElements.showFor["3dhotspot"],"3dmodelobject":this.core.config.displayElements.showFor["3dmodelobject"],other:this.core.config.displayElements.showFor.other};this.core.config.thumbnailSettings.showFor=e,console.log("üîß DISPLAY CONFIG: Copied thumbnail visibility settings:",this.core.config.thumbnailSettings.showFor)}else this.core.config.thumbnailSettings.showFor={panorama:!0,hotspot:!0,polygon:!0,video:!0,webframe:!0,image:!0,text:!0,projectedimage:!0,element:!0,business:!0,container:!0,"3dmodel":!0,"3dhotspot":!0,"3dmodelobject":!0,other:!0},console.log("üîß DISPLAY CONFIG: Initialized default thumbnail visibility settings");console.log("üîß DISPLAY CONFIG: General display settings updated"),console.log("üîç DEBUG - Final thumbnail settings after display config update:",{thumbnailSettings:this.core.config.thumbnailSettings,displayElements:this.core.config.displayElements})}catch(e){console.error("üö® Error updating display config from form:",e)}}setupBorderValidation(e){try{const t=e.querySelector("#thumbnailBorderRadius"),o=e.querySelector("#thumbnailBorderWidth");t&&(t.addEventListener("input",e=>{this.validateBorderRadius(e.target,e.target.value)}),t.addEventListener("change",e=>{this.validateBorderRadius(e.target,e.target.value)})),o&&(o.addEventListener("input",e=>{this.validateBorderWidth(e.target,e.target.value)}),o.addEventListener("change",e=>{this.validateBorderWidth(e.target,e.target.value)})),console.log("üëÅÔ∏è Border validation setup complete")}catch(e){console.error("Error setting up border validation:",e)}}handleThumbnailSizeChange(e){try{const t=e.value;this.core.setNestedValue(this.core.config,"thumbnailSettings.thumbnailSize",t),this.core.onFormChange(e),console.log(`üñºÔ∏è Thumbnail size changed to: ${t}`)}catch(e){console.error("Error handling thumbnail size change:",e)}}}"undefined"!=typeof module&&module.exports?module.exports=DisplayTabHandler:window.DisplayTabHandler=DisplayTabHandler;