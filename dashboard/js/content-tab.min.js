/* Search Pro v3.1 - Last Update on 10/31/2025 - Race Condition Fix */
class ContentTabHandler{constructor(){this.core=null,this.tabId="content"}setCore(e){this.core=e}init(e){try{console.log("ðŸ“„ Initializing Content tab handler"),this.core.setupFormListeners(e),this.setupContainerSearchHandlers(e),this.populateContentForm(e),this.validateForm(e),this.setupResetButtonHandlers(e),console.log("âœ… Content tab handler initialized")}catch(e){console.error("âŒ Error initializing Content tab:",e)}}populateContentForm(e){try{this.core.populateForm(e);const t=e.querySelector("#containerNames");if(t&&this.core.config.includeContent?.containerSearch?.containerNames){const e=this.core.config.includeContent.containerSearch.containerNames;Array.isArray(e)?t.value=e.join(", "):t.value=""}console.log("ðŸ“„ Content form populated")}catch(e){console.error("ðŸš¨ Security: Error populating content form:",e)}}setupContainerSearchHandlers(e){try{const t=e.querySelector("#enableContainerSearch"),n=e.querySelector("#containerNames");t&&n&&(t.addEventListener("change",()=>{n.disabled=!t.checked,t.checked&&n.focus()}),n.disabled=!t.checked),n&&n.addEventListener("change",e=>{this.handleContainerNamesChange(e.target)}),console.log("ðŸ“„ Container search handlers initialized")}catch(e){console.error("ðŸš¨ Security: Error setting up container search handlers:",e)}}handleContainerNamesChange(e){try{const t=this.core.sanitizeInput(e.value).split(",").map(e=>e.trim()).filter(e=>e.length>0);this.core.config.includeContent||(this.core.config.includeContent={}),this.core.config.includeContent.containerSearch||(this.core.config.includeContent.containerSearch={}),this.core.config.includeContent.containerSearch.containerNames=t,console.log("ðŸ“„ Container names updated:",t)}catch(e){console.error("ðŸš¨ Security: Error handling container names change:",e)}}setupResetButtonHandlers(e){try{const t=e.querySelectorAll(".reset-section-button");t.forEach(e=>{e.addEventListener("click",e=>{e.preventDefault();const t=e.target.closest("button").dataset.section;t&&("contentInclusion"===t?this.resetContentInclusionToDefaults():"elementTypes"===t?this.resetElementTypesToDefaults():"containerSearch"===t&&this.resetContainerSearchToDefaults())})}),console.log(`ðŸ”„ Reset button handlers set up for ${t.length} buttons`)}catch(e){console.error("ðŸš¨ Security: Error setting up reset button handlers:",e)}}resetContentInclusionToDefaults(){try{const e=this.core.getDefaultConfig().includeContent||{};this.core.config.includeContent||(this.core.config.includeContent={}),this.core.config.includeContent.unlabeledWithSubtitles=void 0===e.unlabeledWithSubtitles||e.unlabeledWithSubtitles,this.core.config.includeContent.unlabeledWithTags=void 0===e.unlabeledWithTags||e.unlabeledWithTags,this.core.config.includeContent.completelyBlank=void 0===e.completelyBlank||e.completelyBlank;const t=document.getElementById("content-panel");t&&this.populateContentForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Content inclusion options reset to defaults"),console.log("ðŸ”„ Content inclusion options reset to defaults")}catch(e){console.error("ðŸš¨ Security: Error resetting content inclusion options:",e)}}resetElementTypesToDefaults(){try{const e=this.core.getDefaultConfig().includeContent?.elements||{};this.core.config.includeContent||(this.core.config.includeContent={}),this.core.config.includeContent.elements||(this.core.config.includeContent.elements={}),["includePanoramas","includeHotspots","includePolygons","includeVideos","includeWebframes","includeImages","includeText","includeProjectedImages","include3DHotspots","include3DModels","include3DModelObjects","includeBusiness","includeContainers","skipEmptyLabels"].forEach(t=>{this.core.config.includeContent.elements[t]=void 0===e[t]||e[t]}),this.core.config.includeContent.elements.minLabelLength=void 0!==e.minLabelLength?e.minLabelLength:0;const t=document.getElementById("content-panel");t&&this.populateContentForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Element type options reset to defaults"),console.log("ðŸ”„ Element type options reset to defaults")}catch(e){console.error("ðŸš¨ Security: Error resetting element type options:",e)}}resetContainerSearchToDefaults(){try{const e=this.core.getDefaultConfig().includeContent?.containerSearch||{};this.core.config.includeContent||(this.core.config.includeContent={}),this.core.config.includeContent.containerSearch||(this.core.config.includeContent.containerSearch={}),this.core.config.includeContent.containerSearch.enableContainerSearch=void 0===e.enableContainerSearch||e.enableContainerSearch,this.core.config.includeContent.containerSearch.containerNames=Array.isArray(e.containerNames)?[...e.containerNames]:["My_Container","TwinsViewer-Container"];const t=document.getElementById("content-panel");t&&this.populateContentForm(t),this.core.showToast&&this.core.showToast("success","Reset Complete","Container search options reset to defaults"),console.log("ðŸ”„ Container search options reset to defaults")}catch(e){console.error("ðŸš¨ Security: Error resetting container search options:",e)}}validateField(e){try{const t="checkbox"===e.type?e.checked:e.value,n=this.core.sanitizeInput(e.name||e.id,100);let o=!0;if(o=this.core.validateField(e),"includeContent.elements.minLabelLength"===n){const e=parseInt(t);(isNaN(e)||e<0)&&(o=!1)}else if("containerNames"===n){const e=t.split(",");for(const t of e){const e=t.trim();if(e&&!/^[a-zA-Z0-9_-]+$/.test(e)){o=!1;break}}}return o?(e.classList.remove("error"),e.classList.add("valid")):e.classList.add("error"),o}catch(e){return console.error("ðŸš¨ Security: Error in Content tab field validation:",e),!1}}validateForm(e=document){try{const t=e.querySelectorAll(".form-input, .toggle-input, .range-input, .form-select");let n=!0;return t.forEach(e=>{this.validateField(e)||(n=!1)}),console.log("ðŸ“„ Content tab validation: "+(n?"PASSED":"FAILED")),n}catch(e){return console.error("ðŸš¨ Security: Error validating Content tab form:",e),!1}}onFormChange(e){try{if("containerNames"===(e.name||e.id))return void this.handleContainerNamesChange(e);this.core.onFormChange(e)}catch(e){console.error("ðŸš¨ Security: Error handling Content tab form change:",e)}}applyLivePreview(e,t){try{const n=JSON.parse(JSON.stringify(this.core.config));if(this.core.safeSetNestedProperty(n,e,t),this.core.safeLocalStorageSet("searchProLiveConfig",n),window.parent&&window.parent!==window)try{window.parent.postMessage({type:"searchProConfigPreview",config:n,field:this.core.sanitizeInput(e),value:"string"==typeof t?this.core.sanitizeInput(t):t,section:"content"},"*")}catch(e){console.warn("ðŸš¨ Security: Error posting message to parent:",e)}console.log(`ðŸ“„ Content live preview: ${e} = ${t}`)}catch(e){console.warn("ðŸš¨ Security: Content tab live preview failed:",e)}}resetToDefaults(){try{console.log("ðŸ”„ Resetting Content tab to defaults");const e=this.core.getDefaultConfig();e.includeContent?this.core.config.includeContent=JSON.parse(JSON.stringify(e.includeContent)):this.core.config.includeContent={unlabeledWithSubtitles:!0,unlabeledWithTags:!0,completelyBlank:!0,elements:{includePanoramas:!0,includeHotspots:!0,includePolygons:!0,includeVideos:!0,includeWebframes:!0,includeImages:!0,includeText:!0,includeProjectedImages:!0,include3DHotspots:!0,include3DModels:!0,include3DModelObjects:!0,includeBusiness:!0,includeContainers:!0,skipEmptyLabels:!0,minLabelLength:0},containerSearch:{enableContainerSearch:!0,containerNames:["My_Container","TwinsViewer-Container"]}};const t=document.getElementById("content-panel");t&&this.populateContentForm(t),console.log("âœ… Content tab reset complete")}catch(e){console.error("ðŸš¨ Security: Error resetting Content tab:",e)}}getConfigSummary(){try{return{tab:"Content",sections:{contentInclusion:{unlabeledWithSubtitles:this.core.config.includeContent?.unlabeledWithSubtitles,unlabeledWithTags:this.core.config.includeContent?.unlabeledWithTags,completelyBlank:this.core.config.includeContent?.completelyBlank},elementTypes:this.core.config.includeContent?.elements||{},containerSearch:this.core.config.includeContent?.containerSearch||{}}}}catch(e){return console.error("ðŸš¨ Security: Error getting Content tab config summary:",e),null}}cleanup(){try{console.log("ðŸ§¹ Content tab handler cleaned up")}catch(e){console.error("ðŸš¨ Security: Error cleaning up Content tab:",e)}}updateConfigFromForm(e){try{const t=e.querySelector("#containerNames");t&&this.handleContainerNamesChange(t),console.log("ðŸ“„ Content tab config updated from form")}catch(e){console.error("ðŸš¨ Security: Error updating content tab config from form:",e)}}}"undefined"!=typeof module&&module.exports?module.exports=ContentTabHandler:window.ContentTabHandler=ContentTabHandler;