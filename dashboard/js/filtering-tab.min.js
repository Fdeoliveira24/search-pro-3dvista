/* Search Pro v3.1 - Last Update on 10/31/2025 - Race Condition Fix */
class FilteringTabHandler{constructor(){this.core=null,this.tabId="filtering",this.formUpdateTimeout=null}setCore(e){this.core=e}init(e){try{console.log("ğŸš€ Initializing Filtering tab handler"),this.core.setupFormListeners(e),this.setupFilterModeControls(e),this.setupMediaIndexControls(e),this.setupElementTypeControls(e),this.setupElementLabelControls(e),this.setupTagFilteringControls(e),this.setupArrayInputHandlers(e),this.core.populateForm(e),this.setupResetButtonHandlers(e),this.updateFilterVisibility(e),this.validateForm(e),console.log("âœ… Filtering tab handler initialized")}catch(e){console.error("âŒ Error initializing Filtering tab:",e)}}setupFilterModeControls(e=document){try{const t=e.querySelector("#filterMode");t&&t.addEventListener("change",()=>{this.updateFilterVisibility(e),this.validateForm(e)}),console.log("ğŸ›ï¸ Filter mode controls setup complete")}catch(e){console.error("ğŸš¨ Error setting up filter mode controls:",e)}}setupMediaIndexControls(e=document){try{const t=e.querySelector('[name="filter.mediaIndexes.mode"]');t&&t.addEventListener("change",()=>{this.updateMediaIndexVisibility(e)}),e.querySelectorAll("#allowedMediaIndexes, #blacklistedMediaIndexes").forEach(e=>{e.addEventListener("input",e=>{this.filterMediaIndexInput(e.target),this.validateMediaIndexInput(e.target)}),e.addEventListener("blur",e=>{this.validateMediaIndexInput(e.target)}),e.addEventListener("paste",e=>{setTimeout(()=>{this.filterMediaIndexInput(e.target),this.validateMediaIndexInput(e.target)},10)})}),console.log("ğŸ“· Media index controls setup complete")}catch(e){console.error("ğŸš¨ Error setting up media index controls:",e)}}filterMediaIndexInput(e){try{const t=e.value,l=t.replace(/[^\d,\s]/g,"");t!==l&&(e.value=l,this.showValidationMessage(e,"Invalid characters removed. Only numbers, commas, and spaces are allowed."),setTimeout(()=>{this.validateMediaIndexInput(e)&&this.clearValidationMessage(e)},1500))}catch(e){console.error("ğŸš¨ Error filtering media index input:",e)}}validateMediaIndexInput(e){try{const t=e.value.trim();if(!t)return e.classList.remove("validation-error"),this.clearValidationMessage(e),!0;const l=/^[\d\s,]+$/.test(t);let i=!0,o="";if(l){const e=t.split(",").map(e=>e.trim()).filter(e=>""!==e);for(const t of e){const e=parseInt(t,10);if(isNaN(e)||e<0){i=!1,o="All values must be non-negative integers (0, 1, 2, etc.)";break}}if(i){const t=[...new Set(e)];e.length!==t.length&&(i=!1,o="Duplicate panorama indexes are not allowed")}}const r=l&&i;return e.classList.toggle("validation-error",!r),r?this.clearValidationMessage(e):l?this.showValidationMessage(e,o):this.showValidationMessage(e,"Only numbers, commas, and spaces are allowed (e.g., 0, 1, 5)"),r}catch(e){return console.error("ğŸš¨ Error validating media index input:",e),!1}}setupElementTypeControls(e=document){try{const t=e.querySelector("#elementTypesMode");t&&t.addEventListener("change",()=>{this.updateElementTypesVisibility(e),this.validateForm(e)}),e.querySelectorAll('#allowedElementTypesCheckboxes input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{this.updateElementTypeCheckboxArrays(e,"allowed")})}),e.querySelectorAll('#blacklistedElementTypesCheckboxes input[type="checkbox"]').forEach(t=>{t.addEventListener("change",()=>{this.updateElementTypeCheckboxArrays(e,"blacklisted")})}),console.log("ğŸ”§ Element type controls setup complete")}catch(e){console.error("ğŸš¨ Error setting up element type controls:",e)}}setupElementLabelControls(e=document){try{const t=e.querySelector("#elementLabelsMode");t&&t.addEventListener("change",()=>{this.updateElementLabelsVisibility(e),this.validateForm(e)}),console.log("ğŸ·ï¸ Element label controls setup complete")}catch(e){console.error("ğŸš¨ Error setting up element label controls:",e)}}setupTagFilteringControls(e=document){try{const t=e.querySelector("#tagFilteringMode");t&&t.addEventListener("change",()=>{this.updateTagFilteringVisibility(e),this.validateForm(e)}),console.log("ğŸ·ï¸ Tag filtering controls setup complete")}catch(e){console.error("ğŸš¨ Error setting up tag filtering controls:",e)}}setupArrayInputHandlers(e=document){try{e.querySelectorAll("#allowedValues, #blacklistedValues, #allowedElementLabels, #blacklistedElementLabels, #allowedTags, #blacklistedTags").forEach(e=>{e.addEventListener("change",()=>{this.updateArrayValue(e)}),e.addEventListener("input",()=>{this.validateArrayInput(e)})}),console.log("ğŸ“‹ Array input handlers setup complete")}catch(e){console.error("ğŸš¨ Error setting up array input handlers:",e)}}updateFilterVisibility(e=document){try{const t=e.querySelector("#filterMode")?.value||"none",l=e.querySelector("#allowedValuesGroup"),i=e.querySelector("#blacklistedValuesGroup"),o=e.querySelector("#mainFilterValues");o&&(o.style.display="none"!==t?"block":"none"),l&&(l.style.display="whitelist"===t?"block":"none"),i&&(i.style.display="blacklist"===t?"block":"none"),console.log(`ğŸ”„ Filter visibility updated: mode=${t}`)}catch(e){console.error("ğŸš¨ Error updating filter visibility:",e)}}updateMediaIndexVisibility(e=document){try{const t=e.querySelector("#mediaIndexMode")?.value||"none",l=e.querySelector("#allowedMediaIndexesGroup"),i=e.querySelector("#blacklistedMediaIndexesGroup"),o=e.querySelector("#mediaIndexValues");o&&(o.style.display="none"!==t?"block":"none"),l&&(l.style.display="whitelist"===t?"block":"none"),i&&(i.style.display="blacklist"===t?"block":"none"),console.log(`ğŸ”„ Media index visibility updated: mode=${t}`)}catch(e){console.error("ğŸš¨ Error updating media index visibility:",e)}}updateElementTypesVisibility(e=document){try{const t=e.querySelector("#elementTypesMode")?.value||"none",l=e.querySelector("#allowedElementTypesGroup"),i=e.querySelector("#blacklistedElementTypesGroup"),o=e.querySelector("#elementTypesValues");o&&(o.style.display="none"!==t?"block":"none"),l&&(l.style.display="whitelist"===t?"block":"none"),i&&(i.style.display="blacklist"===t?"block":"none"),console.log(`ğŸ”„ Element types visibility updated: mode=${t}`)}catch(e){console.error("ğŸš¨ Error updating element types visibility:",e)}}updateElementLabelsVisibility(e=document){try{const t=e.querySelector("#elementLabelsMode")?.value||"none",l=e.querySelector("#allowedElementLabelsGroup"),i=e.querySelector("#blacklistedElementLabelsGroup"),o=e.querySelector("#elementLabelsValues");o&&(o.style.display="none"!==t?"block":"none"),l&&(l.style.display="whitelist"===t?"block":"none"),i&&(i.style.display="blacklist"===t?"block":"none"),console.log(`ğŸ”„ Element labels visibility updated: mode=${t}`)}catch(e){console.error("ğŸš¨ Error updating element labels visibility:",e)}}updateTagFilteringVisibility(e=document){try{const t=e.querySelector("#tagFilteringMode")?.value||"none",l=e.querySelector("#allowedTagsGroup"),i=e.querySelector("#blacklistedTagsGroup"),o=e.querySelector("#tagFilteringValues");o&&(o.style.display="none"!==t?"block":"none"),l&&(l.style.display="whitelist"===t?"block":"none"),i&&(i.style.display="blacklist"===t?"block":"none"),console.log(`ğŸ”„ Tag filtering visibility updated: mode=${t}`)}catch(e){console.error("ğŸš¨ Error updating tag filtering visibility:",e)}}updateArrayValue(e){try{const t=e.value.trim(),l=t?t.split(",").map(e=>e.trim()).filter(e=>e.length>0):[],i=e.getAttribute("name");i&&this.core&&(this.core.setNestedProperty(this.core.config,i,l),console.log(`ğŸ“ Updated ${i}:`,l))}catch(e){console.error("ğŸš¨ Error updating array value:",e)}}updateElementTypeArrays(e){try{const t=Array.from(e.selectedOptions).map(e=>e.value),l=t.length>0?t:[],i=e.getAttribute("name");i&&this.core&&(this.core.setNestedProperty(this.core.config,i,l),console.log(`ğŸ“ Updated ${i}:`,l))}catch(e){console.error("ğŸš¨ Error updating element type arrays:",e)}}updateElementTypeCheckboxArrays(e,t){try{const l="allowed"===t?'#allowedElementTypesCheckboxes input[type="checkbox"]:checked':'#blacklistedElementTypesCheckboxes input[type="checkbox"]:checked',i=e.querySelectorAll(l),o=Array.from(i).map(e=>e.value),r=o.length>0?o:[],s="allowed"===t?"filter.elementTypes.allowedTypes":"filter.elementTypes.blacklistedTypes";this.core&&(this.core.setNestedProperty(this.core.config,s,r),console.log(`ğŸ“ Updated ${s}:`,r))}catch(e){console.error("ğŸš¨ Error updating element type checkbox arrays:",e)}}validateArrayInput(e){try{const t=e.value.trim().length<=1e3;return e.classList.toggle("validation-error",!t),t?this.clearValidationMessage(e):this.showValidationMessage(e,"Input is too long. Please limit to 1000 characters."),t}catch(e){return console.error("ğŸš¨ Error validating array input:",e),!1}}setupResetButtonHandlers(e=document){try{const t=e.querySelectorAll(".reset-section-button");t.forEach(t=>{t.addEventListener("click",()=>{const l=t.dataset.section;console.log(`ğŸ”„ Reset button clicked for section: ${l}`),"filtering"===l?this.resetFilteringSettings(e):"elementTypes"===l?this.resetElementTypesSettings(e):"mediaIndexes"===l?this.resetMediaIndexesSettings(e):"tagFiltering"===l?this.resetTagFilteringSettings(e):"elementLabels"===l?this.resetElementLabelsSettings(e):"valueMatching"===l?this.resetValueMatchingSettings(e):console.warn(`ğŸš¨ Unknown reset section: ${l}`)})}),console.log(`ğŸ”„ Reset button handlers setup complete for ${t.length} buttons`)}catch(e){console.error("ğŸš¨ Error setting up reset button handlers:",e)}}resetFilteringSettings(e=document){try{if(!this.core)return;const t={mode:"none",allowedValues:[],blacklistedValues:[],valueMatchMode:{whitelist:"exact",blacklist:"contains"},mediaIndexes:{mode:"none",allowed:[],blacklisted:[]},elementTypes:{mode:"none",allowedTypes:[],blacklistedTypes:[]},elementLabels:{mode:"none",allowedValues:[],blacklistedValues:[]},tagFiltering:{mode:"none",allowedTags:[],blacklistedTags:[]}};this.core.config.filter=t,this.core.populateForm(e),this.updateFilterVisibility(e),this.updateMediaIndexVisibility(e),this.updateElementTypesVisibility(e),this.updateElementLabelsVisibility(e),this.updateTagFilteringVisibility(e),this.core.showToast("Filtering settings reset to defaults","success"),console.log("âœ… Filtering settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting filtering settings:",e),this.core.showToast("Error resetting filtering settings","error")}}resetElementTypesSettings(e=document){try{if(!this.core)return;this.core.config.filter.elementTypes={mode:"none",allowedTypes:[],blacklistedTypes:[]},this.core.populateForm(e),this.updateElementTypesVisibility(e),this.core.showToast("Element types settings reset to defaults","success"),console.log("âœ… Element types settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting element types settings:",e),this.core.showToast("Error resetting element types settings","error")}}resetMediaIndexesSettings(e=document){try{if(!this.core)return;this.core.config.filter.mediaIndexes={mode:"none",allowed:[],blacklisted:[]},this.core.populateForm(e),this.updateMediaIndexVisibility(e),this.core.showToast("Media indexes settings reset to defaults","success"),console.log("âœ… Media indexes settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting media indexes settings:",e),this.core.showToast("Error resetting media indexes settings","error")}}resetTagFilteringSettings(e=document){try{if(!this.core)return;this.core.config.filter.tagFiltering={mode:"none",allowedTags:[],blacklistedTags:[]},this.core.populateForm(e),this.updateTagFilteringVisibility(e),this.core.showToast("Tag filtering settings reset to defaults","success"),console.log("âœ… Tag filtering settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting tag filtering settings:",e),this.core.showToast("Error resetting tag filtering settings","error")}}resetElementLabelsSettings(e=document){try{if(!this.core)return;this.core.config.filter.elementLabels={mode:"none",allowedValues:[],blacklistedValues:[]},this.core.populateForm(e),this.updateElementLabelsVisibility(e),this.core.showToast("Element labels settings reset to defaults","success"),console.log("âœ… Element labels settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting element labels settings:",e),this.core.showToast("Error resetting element labels settings","error")}}resetValueMatchingSettings(e=document){try{if(!this.core)return;this.core.config.filter.mode="none",this.core.config.filter.allowedValues=[],this.core.config.filter.blacklistedValues=[],this.core.config.filter.valueMatchMode={whitelist:"exact",blacklist:"contains"},this.core.populateForm(e),this.updateFilterVisibility(e),this.core.showToast("Value matching settings reset to defaults","success"),console.log("âœ… Value matching settings reset to defaults")}catch(e){console.error("ğŸš¨ Error resetting value matching settings:",e),this.core.showToast("Error resetting value matching settings","error")}}validateForm(e=document){try{let t=!0;return e.querySelectorAll("#allowedMediaIndexes, #blacklistedMediaIndexes").forEach(e=>{this.validateMediaIndexInput(e)||(t=!1)}),e.querySelectorAll("#allowedValues, #blacklistedValues, #allowedElementLabels, #blacklistedElementLabels, #allowedTags, #blacklistedTags").forEach(e=>{this.validateArrayInput(e)||(t=!1)}),console.log("ğŸ“‹ Filtering form validation: "+(t?"passed":"failed")),t}catch(e){return console.error("ğŸš¨ Error validating filtering form:",e),!1}}showValidationMessage(e,t){try{let l=e.parentNode.querySelector(".validation-message");l||(l=document.createElement("div"),l.className="validation-message validation-error",e.parentNode.appendChild(l)),l.textContent=t,l.style.display="block",l.classList.add("show"),e.style.borderColor="#ef4444",e.style.backgroundColor="#fef2f2"}catch(e){console.error("ğŸš¨ Error showing validation message:",e)}}clearValidationMessage(e){try{const t=e.parentNode.querySelector(".validation-message");t&&(t.style.display="none",t.classList.remove("show")),e.style.borderColor="",e.style.backgroundColor=""}catch(e){console.error("ğŸš¨ Error clearing validation message:",e)}}getConfig(){try{return this.core?.config?.filter||{}}catch(e){return console.error("ğŸš¨ Error getting filtering config:",e),{}}}updateConfig(e){try{if(!this.core||!e)return;this.core.config.filter={...this.core.config.filter,...e},console.log("ğŸ“ Filtering configuration updated:",this.core.config.filter)}catch(e){console.error("ğŸš¨ Error updating filtering config:",e)}}resetToDefaults(){try{if(console.log("ğŸ”„ Resetting Filtering tab to defaults"),this.core&&this.core.config){const e=this.core.getDefaultConfig();this.core.config.filter={...e.filter},console.log("âœ… Filtering configuration reset to defaults:",this.core.config.filter)}const e=document.getElementById("filtering-panel");e&&(this.resetFormFields(e),this.updateFilterVisibility(e),this.updateMediaIndexVisibility(e),this.updateElementTypesVisibility(e),this.updateElementLabelsVisibility(e),this.updateTagFilteringVisibility(e),this.validateForm(e),console.log("âœ… Filtering tab form reset to defaults")),console.log("âœ… Filtering tab reset complete")}catch(e){console.error("ğŸš¨ Error resetting filtering tab:",e)}}resetFormFields(e){try{console.log("ğŸ”§ Manually resetting filtering form fields...");const t=e.querySelector('[name="filter.mode"]');t&&(t.value="none",console.log("âœ… Filter mode reset to 'none'"));const l=e.querySelector('[name="filter.allowedValues"]');l&&(l.value="",console.log("âœ… Allowed values cleared"));const i=e.querySelector('[name="filter.blacklistedValues"]');i&&(i.value="",console.log("âœ… Blacklisted values cleared"));const o=e.querySelector('[name="filter.valueMatchMode.whitelist"]');o&&(o.value="exact",console.log("âœ… Whitelist match mode reset to 'exact'"));const r=e.querySelector('[name="filter.valueMatchMode.blacklist"]');r&&(r.value="contains",console.log("âœ… Blacklist match mode reset to 'contains'"));const s=e.querySelector('[name="filter.mediaIndexes.mode"]');s&&(s.value="none",console.log("âœ… Media index mode reset to 'none'"));const n=e.querySelector('[name="filter.mediaIndexes.allowed"]');n&&(n.value="",console.log("âœ… Media index allowed cleared"));const a=e.querySelector('[name="filter.mediaIndexes.blacklisted"]');a&&(a.value="",console.log("âœ… Media index blacklisted cleared"));const c=e.querySelector('[name="filter.elementTypes.mode"]');c&&(c.value="none",console.log("âœ… Element types mode reset to 'none'"));const d=e.querySelector('[name="filter.elementTypes.allowedTypes"]');d&&(d.value="",console.log("âœ… Element types allowed cleared"));const g=e.querySelector('[name="filter.elementTypes.blacklistedTypes"]');g&&(g.value="",console.log("âœ… Element types blacklisted cleared"));const f=e.querySelector('[name="filter.elementLabels.mode"]');f&&(f.value="none",console.log("âœ… Element labels mode reset to 'none'"));const u=e.querySelector('[name="filter.elementLabels.allowedValues"]');u&&(u.value="",console.log("âœ… Element labels allowed cleared"));const m=e.querySelector('[name="filter.elementLabels.blacklistedValues"]');m&&(m.value="",console.log("âœ… Element labels blacklisted cleared"));const y=e.querySelector('[name="filter.tagFiltering.mode"]');y&&(y.value="none",console.log("âœ… Tag filtering mode reset to 'none'"));const h=e.querySelector('[name="filter.tagFiltering.allowedTags"]');h&&(h.value="",console.log("âœ… Tag filtering allowed cleared"));const p=e.querySelector('[name="filter.tagFiltering.blacklistedTags"]');p&&(p.value="",console.log("âœ… Tag filtering blacklisted cleared")),console.log("âœ… All filtering form fields manually reset")}catch(e){console.error("ğŸš¨ Error manually resetting form fields:",e)}}updateConfigFromForm(e){try{console.log("ğŸ” FilteringTab updateConfigFromForm called"),console.log("ğŸ“‹ Current filter config after main form processing:",this.core.config.filter);const t=e||document.getElementById("filtering-panel");t&&(this.core.config.filter?.elementTypes?.allowedTypes&&Array.isArray(this.core.config.filter.elementTypes.allowedTypes)?console.log("âœ… SKIP: allowedTypes already properly set, not overriding"):(console.log("ğŸ”§ INIT: Initializing allowedTypes from checkboxes"),this.updateElementTypeCheckboxArrays(t,"allowed")),this.core.config.filter?.elementTypes?.blacklistedTypes&&Array.isArray(this.core.config.filter.elementTypes.blacklistedTypes)?console.log("âœ… SKIP: blacklistedTypes already properly set, not overriding"):(console.log("ğŸ”§ INIT: Initializing blacklistedTypes from checkboxes"),this.updateElementTypeCheckboxArrays(t,"blacklisted"))),this.core.config.filter&&("string"==typeof this.core.config.filter.allowedValues&&(this.core.config.filter.allowedValues=this.core.config.filter.allowedValues.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted allowedValues from string to array:",this.core.config.filter.allowedValues)),"string"==typeof this.core.config.filter.blacklistedValues&&(this.core.config.filter.blacklistedValues=this.core.config.filter.blacklistedValues.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted blacklistedValues from string to array:",this.core.config.filter.blacklistedValues)),"string"==typeof this.core.config.filter.tagFiltering?.allowedTags&&(this.core.config.filter.tagFiltering.allowedTags=this.core.config.filter.tagFiltering.allowedTags.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted allowedTags from string to array:",this.core.config.filter.tagFiltering.allowedTags)),"string"==typeof this.core.config.filter.tagFiltering?.blacklistedTags&&(this.core.config.filter.tagFiltering.blacklistedTags=this.core.config.filter.tagFiltering.blacklistedTags.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted blacklistedTags from string to array:",this.core.config.filter.tagFiltering.blacklistedTags)),"string"==typeof this.core.config.filter.mediaIndexes?.allowed&&(this.core.config.filter.mediaIndexes.allowed=this.core.config.filter.mediaIndexes.allowed.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted mediaIndexes.allowed from string to array:",this.core.config.filter.mediaIndexes.allowed)),"string"==typeof this.core.config.filter.mediaIndexes?.blacklisted&&(this.core.config.filter.mediaIndexes.blacklisted=this.core.config.filter.mediaIndexes.blacklisted.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted mediaIndexes.blacklisted from string to array:",this.core.config.filter.mediaIndexes.blacklisted)),"string"==typeof this.core.config.filter.elementLabels?.allowedValues&&(this.core.config.filter.elementLabels.allowedValues=this.core.config.filter.elementLabels.allowedValues.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted elementLabels.allowedValues from string to array:",this.core.config.filter.elementLabels.allowedValues)),"string"==typeof this.core.config.filter.elementLabels?.blacklistedValues&&(this.core.config.filter.elementLabels.blacklistedValues=this.core.config.filter.elementLabels.blacklistedValues.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted elementLabels.blacklistedValues from string to array:",this.core.config.filter.elementLabels.blacklistedValues)),"string"==typeof this.core.config.filter.elementTypes?.allowedTypes&&(this.core.config.filter.elementTypes.allowedTypes=this.core.config.filter.elementTypes.allowedTypes.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted elementTypes.allowedTypes from string to array:",this.core.config.filter.elementTypes.allowedTypes)),"string"==typeof this.core.config.filter.elementTypes?.blacklistedTypes&&(this.core.config.filter.elementTypes.blacklistedTypes=this.core.config.filter.elementTypes.blacklistedTypes.split(",").map(e=>e.trim()).filter(e=>""!==e),console.log("ğŸ”§ FILTER FIX: Converted elementTypes.blacklistedTypes from string to array:",this.core.config.filter.elementTypes.blacklistedTypes)),Array.isArray(this.core.config.filter.blacklistedValues)&&(this.core.config.filter.blacklistedValues=this.core.config.filter.blacklistedValues.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.allowedValues)&&(this.core.config.filter.allowedValues=this.core.config.filter.allowedValues.filter(e=>e&&""!==e.trim())),this.core.config.filter.tagFiltering&&(Array.isArray(this.core.config.filter.tagFiltering.blacklistedTags)&&(this.core.config.filter.tagFiltering.blacklistedTags=this.core.config.filter.tagFiltering.blacklistedTags.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.tagFiltering.allowedTags)&&(this.core.config.filter.tagFiltering.allowedTags=this.core.config.filter.tagFiltering.allowedTags.filter(e=>e&&""!==e.trim()))),this.core.config.filter.elementLabels&&(Array.isArray(this.core.config.filter.elementLabels.blacklistedValues)&&(this.core.config.filter.elementLabels.blacklistedValues=this.core.config.filter.elementLabels.blacklistedValues.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.elementLabels.allowedValues)&&(this.core.config.filter.elementLabels.allowedValues=this.core.config.filter.elementLabels.allowedValues.filter(e=>e&&""!==e.trim()))),this.core.config.filter.mediaIndexes&&(Array.isArray(this.core.config.filter.mediaIndexes.blacklisted)&&(this.core.config.filter.mediaIndexes.blacklisted=this.core.config.filter.mediaIndexes.blacklisted.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.mediaIndexes.allowed)&&(this.core.config.filter.mediaIndexes.allowed=this.core.config.filter.mediaIndexes.allowed.filter(e=>e&&""!==e.trim()))),this.core.config.filter.elementLabels&&(Array.isArray(this.core.config.filter.elementLabels.blacklistedValues)&&(this.core.config.filter.elementLabels.blacklistedValues=this.core.config.filter.elementLabels.blacklistedValues.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.elementLabels.allowedValues)&&(this.core.config.filter.elementLabels.allowedValues=this.core.config.filter.elementLabels.allowedValues.filter(e=>e&&""!==e.trim()))),this.core.config.filter.elementTypes&&(Array.isArray(this.core.config.filter.elementTypes.blacklistedTypes)&&(this.core.config.filter.elementTypes.blacklistedTypes=this.core.config.filter.elementTypes.blacklistedTypes.filter(e=>e&&""!==e.trim())),Array.isArray(this.core.config.filter.elementTypes.allowedTypes)&&(this.core.config.filter.elementTypes.allowedTypes=this.core.config.filter.elementTypes.allowedTypes.filter(e=>e&&""!==e.trim()))),this.core.config.filter.elementTypes&&Object.keys(this.core.config.filter.elementTypes).forEach(e=>{Array.isArray(this.core.config.filter.elementTypes[e])&&(this.core.config.filter.elementTypes[e]=this.core.config.filter.elementTypes[e].filter(e=>e&&""!==e.trim()))})),console.log("âœ… Filter configuration cleaned and ready:",this.core.config.filter)}catch(e){console.error("ğŸš¨ Error updating filtering config from form:",e)}}}"undefined"!=typeof module&&module.exports?module.exports=FilteringTabHandler:"undefined"!=typeof window&&(window.FilteringTabHandler=FilteringTabHandler);