<!doctype html>
<!-- Version 4.0 - Last Update on 11/03/2025 - Search Pro V4 Migration: Control Panel and Debug Files Renamed -->
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>Search Pro V4</title>

    <meta name="description" content="Search Pro V4 - Enhanced Configuration Control Panel" />
    <meta name="generator" content="Search Pro V4" />
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin" />
    <meta
      http-equiv="Permissions-Policy"
      content="geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), accelerometer=(), gyroscope=()"
    />

    <!-- ADDITIONAL SECURITY META TAGS -->
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet" />
    <meta name="format-detection" content="telephone=no" />

    <!-- FontAwesome Icons - Using local version only to avoid conflicts -->

    <!-- Your CSS Files -->
    <link rel="stylesheet" href="./css/control-panel-v4.css" />
    <link rel="stylesheet" href="./fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="./css/sidebar-menu.css" />
    <link rel="stylesheet" href="./css/control-panel-tooltip.css" />
    <link rel="stylesheet" href="./css/fab-menu.css" />
    <link rel="stylesheet" href="./css/toast.css" />
    <link rel="stylesheet" href="./css/validation-messages.css" />
    <link rel="stylesheet" href="./css/modal-system.css" />
    <link rel="stylesheet" href="./css/tab-loader.css" />
  </head>
  <body>
    <!-- Toast Notification System -->
    <div id="toastContainer" class="toast-container" aria-live="polite" role="status"></div>

    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar" role="navigation" aria-label="Main navigation">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <div class="sidebar-logo" data-fallback="Logo" aria-label="Company Logo" role="img"></div>
          <div class="sidebar-title brand-text" role="heading" aria-level="1">Search Pro V4</div>
        </div>
        <button
          id="sidebarCollapseBtn"
          class="sidebar-collapse-btn"
          aria-label="Toggle sidebar navigation"
          aria-expanded="true"
          aria-controls="sidebar"
        >
          <i class="fas fa-chevron-left" aria-hidden="true"></i>
        </button>
      </div>

      <div class="sidebar-content">
        <nav class="sidebar-nav" role="tablist">
          <button
            class="nav-item active"
            data-tab="general"
            data-tooltip="General Settings"
            role="tab"
            aria-selected="true"
            aria-controls="general-panel"
            id="general-tab"
          >
            <i class="fas fa-cog" aria-hidden="true"></i>
            <span class="nav-text">General</span>
          </button>
          <button
            class="nav-item"
            data-tab="appearance"
            data-tooltip="Appearance Settings"
            role="tab"
            aria-selected="false"
            aria-controls="appearance-panel"
            id="appearance-tab"
          >
            <i class="fas fa-palette" aria-hidden="true"></i>
            <span class="nav-text">Appearance</span>
          </button>
          <button
            class="nav-item"
            data-tab="display"
            data-tooltip="Display Options"
            role="tab"
            aria-selected="false"
            aria-controls="display-panel"
            id="display-tab"
          >
            <i class="fas fa-eye" aria-hidden="true"></i>
            <span class="nav-text">Display</span>
          </button>
          <button
            class="nav-item"
            data-tab="content"
            data-tooltip="Content Configuration"
            role="tab"
            aria-selected="false"
            aria-controls="content-panel"
            id="content-tab"
          >
            <i class="fas fa-list" aria-hidden="true"></i>
            <span class="nav-text">Content</span>
          </button>
          <button
            class="nav-item"
            data-tab="filtering"
            data-tooltip="Content Filtering"
            role="tab"
            aria-selected="false"
            aria-controls="filtering-panel"
            id="filtering-tab"
          >
            <i class="fas fa-filter" aria-hidden="true"></i>
            <span class="nav-text">Filtering</span>
          </button>
          <button
            class="nav-item"
            data-tab="data-sources"
            data-tooltip="Data Sources"
            role="tab"
            aria-selected="false"
            aria-controls="data-sources-panel"
            id="data-sources-tab"
          >
            <i class="fas fa-database" aria-hidden="true"></i>
            <span class="nav-text">Data Sources</span>
          </button>
          <button
            class="nav-item"
            data-tab="advanced"
            data-tooltip="Advanced Settings"
            role="tab"
            aria-selected="false"
            aria-controls="advanced-panel"
            id="advanced-tab"
          >
            <i class="fas fa-sliders-h" aria-hidden="true"></i>
            <span class="nav-text">Advanced</span>
          </button>
          <button
            class="nav-item"
            data-tab="management"
            data-tooltip="Knowledge Base"
            role="tab"
            aria-selected="false"
            aria-controls="management-panel"
            id="management-tab"
          >
            <i class="fas fa-brain" aria-hidden="true"></i>
            <span class="nav-text">Knowledge</span>
          </button>
        </nav>
      </div>
    </aside>

    <!-- Main Application Container -->
    <div class="app-container">
      <!-- Header Section -->
      <header class="app-header" role="banner">
        <!-- Action Buttons -->
        <div class="header-actions" role="toolbar" aria-label="Main actions">
          <button id="applySettings" class="btn btn-success" type="button" aria-describedby="apply-settings-desc">
            <i class="fas fa-check" aria-hidden="true"></i>
            Apply Settings
          </button>
          <div id="apply-settings-desc" class="sr-only">Apply current configuration settings</div>

          <button id="downloadConfig" class="btn btn-primary" type="button" aria-describedby="download-config-desc">
            <i class="fas fa-download" aria-hidden="true"></i>
            Download
          </button>
          <div id="download-config-desc" class="sr-only">Download configuration as JSON file</div>

          <button id="loadConfig" class="btn btn-secondary" type="button" aria-describedby="load-config-desc">
            <i class="fas fa-upload" aria-hidden="true"></i>
            Load
          </button>
          <div id="load-config-desc" class="sr-only">Load configuration from JSON file</div>

          <button id="resetAll" class="btn btn-warning" type="button" aria-describedby="reset-all-desc">
            <i class="fas fa-undo" aria-hidden="true"></i>
            Reset
          </button>
          <div id="reset-all-desc" class="sr-only">Reset all settings to default values</div>
        </div>
      </header>

      <!-- Main Content -->
      <div class="app-body">
        <!-- Main Content Area -->
        <main class="main-content" id="mainContent" role="main">
          <!-- Tab Panels - Each one will be dynamically loaded -->
          <div id="general-panel" class="tab-panel active" role="tabpanel" aria-labelledby="general-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading General Settings...</p>
            </div>
          </div>

          <div id="appearance-panel" class="tab-panel" role="tabpanel" aria-labelledby="appearance-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Appearance Settings...</p>
            </div>
          </div>

          <div id="display-panel" class="tab-panel" role="tabpanel" aria-labelledby="display-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Display Settings...</p>
            </div>
          </div>

          <div id="content-panel" class="tab-panel" role="tabpanel" aria-labelledby="content-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Content Settings...</p>
            </div>
          </div>

          <div id="filtering-panel" class="tab-panel" role="tabpanel" aria-labelledby="filtering-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Filtering Settings...</p>
            </div>
          </div>

          <div
            id="data-sources-panel"
            class="tab-panel"
            role="tabpanel"
            aria-labelledby="data-sources-tab"
            tabindex="0"
          >
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Data Sources Settings...</p>
            </div>
          </div>

          <div id="advanced-panel" class="tab-panel" role="tabpanel" aria-labelledby="advanced-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Advanced Settings...</p>
            </div>
          </div>

          <div id="management-panel" class="tab-panel" role="tabpanel" aria-labelledby="management-tab" tabindex="0">
            <div class="panel-loading" role="status" aria-live="polite" aria-label="Loading content">
              <div class="loading-spinner" aria-hidden="true"></div>
              <p>Loading Knowledge Base Settings...</p>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- üîí SECURITY: Restricted file input - JS files only (matching export format) -->
    <input type="file" id="fileInput" accept=".js" style="display: none" aria-label="Load configuration file" />

    <!-- üõ°Ô∏è SECURITY: Secure error handling with sanitization -->
    <script>
      // Secure error handling with input sanitization
      window.addEventListener("error", function (e) {
        const sanitizedMessage = e.message ? String(e.message).replace(/[<>]/g, "") : "Unknown error";
        console.error("Global error:", sanitizedMessage);

        if (e.error && e.error.stack) {
          console.error("Error stack:", String(e.error.stack).substring(0, 500));
        }
      });

      window.addEventListener("unhandledrejection", function (e) {
        const sanitizedReason = e.reason ? String(e.reason).replace(/[<>]/g, "") : "Unknown rejection";
        console.error("Unhandled promise rejection:", sanitizedReason);
      });

      // üõ°Ô∏è Security: Prevent console manipulation in production
      if (window.location.hostname !== "localhost" && window.location.hostname !== "127.0.0.1") {
        try {
          console.log = console.warn = console.error = function () {};
        } catch (e) {
          // Ignore if console override fails
        }
      }

      // üîí Security: Basic anti-tampering protection
      try {
        Object.freeze(console);
        Object.freeze(window.console);
      } catch (e) {
        // Ignore if freezing fails
      }
    </script>

    <!-- üöÄ MODULAR JAVASCRIPT ARCHITECTURE -->
    <!-- Load supporting libraries first -->
    <script src="./js/logo-manager.js"></script>
    <script src="./js/toast.js"></script>
    <script src="./js/validation-messages.js"></script>
    <script src="./js/modal-system.js"></script>
    <script src="./js/fab-menu.js"></script>
    <script src="./js/sidebar-menu.js"></script>
    <script src="./js/tab-loader.js"></script>

    <!-- Load modular control panel architecture -->
    <!-- STEP 1: Load Core Module (shared functionality) -->
    <script src="./js/control-panel-core.js"></script>

    <!-- STEP 2: Load Tab Handlers (specific functionality) -->
    <script src="./js/general-tab.js"></script>
    <script src="./js/appearance-tab.js"></script>
    <script src="./js/display-tab.js"></script>
    <script src="./js/content-tab.js"></script>
    <script src="./js/filtering-tab.js?v=6&t=20250824"></script>
    <script>
      console.log("Page loaded at:", new Date().toISOString());
      window.pageLoadTime = Date.now();
    </script>
    <script src="./js/data-sources-tab.js"></script>
    <script src="./js/advanced-tab.js"></script>
    <script src="./js/knowledge-tab.js"></script>
    <script src="./js/fontawesome-icons.js"></script>
    <script src="./js/emoji-library.js"></script>

    <!-- STEP 3: Load Main Controller (orchestrates everything) -->
    <script src="./js/control-panel-v4.js"></script>

    <!-- Professional FAB Menu System -->
    <div class="fab-container" id="fabContainer" role="toolbar" aria-label="Floating action menu">
      <div class="fab-actions" id="fabActions">
        <button
          class="fab-action fab-apply"
          id="fabApply"
          data-label="Apply Settings"
          aria-label="Apply current settings"
        >
          <i class="fas fa-check" aria-hidden="true"></i>
        </button>
        <button
          class="fab-action fab-download"
          id="fabDownload"
          data-label="Download Config"
          aria-label="Download configuration file"
        >
          <i class="fas fa-download" aria-hidden="true"></i>
        </button>
        <button class="fab-action fab-load" id="fabLoad" data-label="Load Config" aria-label="Load configuration file">
          <i class="fas fa-upload" aria-hidden="true"></i>
        </button>
        <button
          class="fab-action fab-reset"
          id="fabReset"
          data-label="Reset All"
          aria-label="Reset all settings to default"
        >
          <i class="fas fa-undo" aria-hidden="true"></i>
        </button>
      </div>
      <button
        class="fab-main"
        id="fabMain"
        aria-label="Open floating action menu"
        aria-expanded="false"
        aria-controls="fabActions"
      >
        <i class="fas fa-plus" aria-hidden="true"></i>
      </button>
      <div class="fab-backdrop" id="fabBackdrop" aria-hidden="true"></div>
    </div>

    <!-- Screen reader only styles for accessibility -->
    <style>
      .sr-only {
        position: absolute;
        width: 1px;
        height: 1px;
        padding: 0;
        margin: -1px;
        overflow: hidden;
        clip: rect(0, 0, 0, 0);
        white-space: nowrap;
        border: 0;
      }

      /* Loading spinner for tab content */
      .loading-spinner {
        width: 40px;
        height: 40px;
        border: 3px solid #f3f3f3;
        border-top: 3px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .panel-loading {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 3rem;
        color: #666;
        font-style: italic;
      }
    </style>

    <!-- JavaScript files are loaded via script tags in the HTML head or body -->

    <!-- Development helper - remove in production -->
    <script>
      // üîß Development Helper: Log modular architecture status
      document.addEventListener("DOMContentLoaded", () => {
        setTimeout(() => {
          console.log("üèóÔ∏è MODULAR ARCHITECTURE STATUS:");
          console.log("  Core Module:", typeof ControlPanelCore !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log("  General Handler:", typeof GeneralTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log(
            "  Appearance Handler:",
            typeof AppearanceTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing"
          );
          console.log("  Display Handler:", typeof DisplayTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log("  Content Handler:", typeof ContentTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log("  Filtering Handler:", typeof FilteringTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log(
            "  DataSources Handler:",
            typeof DataSourcesTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing"
          );
          console.log("  Advanced Handler:", typeof AdvancedTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log("  Knowledge Handler:", typeof KnowledgeTabHandler !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing");
          console.log(
            "  Main Controller:",
            typeof SecureSearchProControlPanel !== "undefined" ? "‚úÖ Loaded" : "‚ùå Missing"
          );

          if (window.searchProControlPanel) {
            console.log("  Registered Handlers:", window.searchProControlPanel.core.tabHandlers.size);
            window.searchProControlPanel.core.tabHandlers.forEach((handler, tabId) => {
              console.log(`    - ${tabId}: ‚úÖ Active`);
            });
          }
        }, 1000);
      });
    </script>
  </body>
</html>
